<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBCG APP - Liturgia 2025 (Ciclo C)</title>
    <!-- Favicon para Navegadores y Accesos Directos en Móviles -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🕊️%3C/text%E3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🕊️%3C/text%E3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
<style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Roboto:wght@400;500;700&display=swap');
        body {
            font-family: 'Merriweather', serif;
            background-image: url('https://www.bibleserver.com/build/bs-start-back-Dno9hVpC.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #433A3F; 
        }
        h1, h2, h3, h4, h5, h6, .nav-item, .filter-button, .main-nav-button {
            font-family: 'Roboto', sans-serif;
        }
        .liturgy-text {
            transition: all 0.3s ease-in-out;
            border-left: 4px solid transparent;
            padding-left: 1rem;
            margin-top: 1rem;
            line-height: 1.7; /* Slightly adjusted line height */
            font-size: 0.9rem; /* Base font size for mobile */
        }
        @media (min-width: 768px) {
            .liturgy-text {
                font-size: 1rem; /* Larger font size for desktop */
            }
        }
        #main-header {
            transition: transform 0.3s ease-in-out;
        }
        .header-hidden {
            transform: translateY(-100%);
        }
        .ref-link {
            cursor: pointer;
            font-weight: bold;
            /* The text color of the word itself is inherited */
            text-decoration: none;
            position: relative;
        }
        .ref-link sup {
            font-size: 0.7em;
            vertical-align: super;
            margin-left: 1px;
            font-weight: 900;
            color: #dc2626; /* red-600 */
        }
        
        /* --- Mobile-Optimized Popup/Modal Styles --- */
        #theology-popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            z-index: 100;
        }
        #theology-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center the popup */
            width: 90%;
            max-width: 450px; /* Slightly wider for more content */
            max-height: 80vh; /* Prevent it from being too tall */
            overflow-y: auto; /* Allow scrolling within the popup */
            background-color: white;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            z-index: 110;
            font-family: 'Merriweather', serif;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #334155;
        }
        #theology-popup h5 {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            color: #0d9488;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        #theology-popup .original-term {
            font-size: 1.5rem;
            font-family: 'Times New Roman', serif;
        }
        #popup-close {
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #94a3b8;
            cursor: pointer;
            line-height: 1;
        }
        #popup-close:hover { color: #475569; }
        
        /* Full Screen Liturgy View Styles */
        #full-liturgy-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #FDFBF5; z-index: 100; overflow-y: auto;
        }
        .liturgy-section h2 {
            font-size: 1.25rem; /* Reduced for mobile */
            font-weight: 700; border-bottom: 2px solid #fBBF24; padding-bottom: 0.5rem; margin-bottom: 1.5rem; margin-top: 2.5rem; color: #1e293b;
        }
        .liturgy-section h3 {
            font-size: 1rem; /* Reduced for mobile */
            font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.5rem; color: #334155;
        }
        @media (min-width: 768px) {
            .liturgy-section h2 { font-size: 1.5rem; }
            .liturgy-section h3 { font-size: 1.1rem; }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1489664942048-a3a60914a2f4?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center;
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center;
            transition: opacity 1.5s ease-in-out;
            padding: 1rem;
        }
        #splash-screen.fade-out {
            opacity: 0;
        }
        .splash-title {
            font-family: 'Merriweather', serif;
            font-size: 2.5rem; sm:font-size: 3rem; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .splash-subtitle {
            font-family: 'Roboto', sans-serif;
            font-size: 1.1rem; sm:font-size: 1.25rem; margin-top: 0.5rem; text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        /* Main Menu */
        .main-nav-button {
            padding: 0.5rem 0;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #4b5563; /* gray-600 */
            transition: all 0.2s ease-in-out;
            font-size: 0.875rem; sm:font-size: 1rem;
        }
        .main-nav-button:hover {
            color: #0d9488; /* teal-600 */
            border-bottom-color: #99f6e4; /* teal-200 */
        }
        .active-nav {
            color: #0f766e; /* teal-700 */
            font-weight: 700;
            border-bottom-color: #0f766e; /* teal-700 */
        }
        
        /* Liturgical Cards Styles */
        .liturgical-card {
            background-color: white;
            border-left-width: 6px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .liturgical-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        /* Mobile Menu Transition */
        .menu-hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* New Lectionary Styles */
        #lectionary-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        #month-selector {
            @apply px-4 py-2 text-base font-medium text-gray-700 bg-white rounded-md shadow-sm border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500;
        }
        #current-month-year {
            font-size: 1.5rem;
            font-weight: bold;
            color: #374151;
        }
        .lectionary-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            text-align: center;
        }
        .calendar-header {
            font-weight: bold;
            color: #4b5563; /* gray-600 */
            padding-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        .calendar-day {
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 9999px;
            transition: background-color 0.2s, color 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1 / 1;
        }
        .calendar-day:not(.empty):hover {
            background-color: #f0fdfa; /* teal-50 */
            color: #0f766e;
        }
        .calendar-day.is-sunday .day-number {
            color: #0f766e; /* teal-700 */
        }
        .day-number {
            font-size: 1rem;
            font-weight: 500;
        }
        .day-name {
            font-size: 0.75rem;
            color: #6b7280;
        }
        .calendar-day.has-data {
            position: relative;
        }
        .calendar-day.has-data::after {
            content: '';
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background-color: #14b8a6; /* teal-500 */
        }
        .calendar-day.empty {
            cursor: default;
            pointer-events: none;
        }
        #lectionary-popup-close {
            font-size: 2rem;
            line-height: 1;
        }
        .office-section h5 {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            margin-top: 1.25rem;
            margin-bottom: 0.25rem;
            color: #334155;
            font-size: 1rem;
        }
        .office-section .liturgy-text {
            border-left: none;
            padding-left: 0;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }


        /* Print Styles */
        .print-only-header { display: none; }
        @media print {
            @page {
                size: letter landscape;
                margin: 1cm;
            }
            body, html { background-color: white !important; }
            body > *:not(#full-liturgy-view) { display: none; }
            #full-liturgy-view {
                position: static; width: auto; height: auto; overflow: visible; background-color: white !important;
            }
            #full-liturgy-header { display: none; }
            .print-only-header { display: block; text-align: center; margin-bottom: 1cm; break-after: avoid; }
            .print-title { font-size: 16pt; font-weight: bold; font-family: 'Times New Roman', Times, serif; }
            .print-subtitle { font-size: 12pt; font-style: italic; font-family: 'Times New Roman', Times, serif; }
            #full-liturgy-content { padding: 0; margin: 0; }
            .print-liturgy-body { column-count: 2; column-gap: 1.5cm; }
            .liturgy-section { break-inside: avoid; }
            .liturgy-section h2 { font-size: 14pt !important; color: black !important; border-bottom: 2px solid black; break-after: avoid; padding-top: 1em; }
            .liturgy-section:first-of-type h2 { padding-top: 0; }
            .liturgy-section h3 { font-size: 11pt !important; color: black !important; }
            body, .liturgy-text, p { font-family: 'Times New Roman', Times, serif; font-size: 10pt !important; color: black !important; background-color: white !important; }
            .ref-link { display: none; }
            #full-liturgy-content .bg-white { box-shadow: none; padding: 0; }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="menu-hidden fixed inset-0 bg-white z-50 flex flex-col items-center justify-center transition-opacity duration-300 ease-in-out">
        <button id="close-menu-btn" class="absolute top-5 right-5 text-gray-600 hover:text-gray-900 p-2">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        <nav id="mobile-nav-links" class="flex flex-col items-center gap-8">
            <a data-view="home" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Inicio</a>
            <a data-view="liturgy" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Liturgia</a>
            <a href="https://www.bibleserver.com/es/NVI/G%C3%A9nesis1" target="_blank" rel="noopener noreferrer" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600">Biblia</a>
            <a data-view="glossary" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Libro de Oración Común</a>
            <a data-view="lectionary" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Leccionario</a>
            <a href="https://www.bibleserver.com/nicodemus-ai" target="_blank" rel="noopener noreferrer" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600">Nicodemus IA</a>
        </nav>
    </div>

    <div id="splash-screen">
        <h1 class="splash-title">Comunidad de Gracia</h1>
        <p class="splash-subtitle">Liturgia y Recursos</p>
    </div>

    <div id="main-content" class="opacity-0 transition-opacity duration-500">
        <header id="main-header" class="bg-white/80 backdrop-blur-sm shadow-sm py-2 px-4 sticky top-0 z-20">
            <div class="container mx-auto flex justify-between items-center">
                <!-- Logo and Title -->
                <div class="flex items-center gap-3">
                    <img id="logo-image" src="https://scontent-mia3-1.xx.fbcdn.net/v/t39.30808-1/458442022_122107426106496454_2577487987417874050_n.jpg?stp=dst-jpg_s200x200_tt6&_nc_cat=111&ccb=1-7&_nc_sid=2d3e12&_nc_ohc=Zy1TV0kujjIQ7kNvwEz8bgt&_nc_oc=Adl4Yh0O1zq-mS8LlfMHzCmTKgBM-yzBhJyyNVnQtxBS9eQMVoKdbqWamxJjkk23f78&_nc_zt=24&_nc_ht=scontent-mia3-1.xx&_nc_gid=AuKzGmho4nnugwzcXEAx7A&oh=00_AfQLVtVuH2tLlf7fZE-otz8oogECgeQlPogoM7mnCAewGA&oe=68938DFE" onerror="this.onerror=null;this.src='https://placehold.co/100x100/3A5F7D/FFFFFF?text=Logo';" alt="Logo Comunidad de Gracia" class="h-10 w-auto rounded-full">
                    <h1 class="text-lg sm:text-xl font-bold text-gray-800">IBCG APP</h1>
                </div>
                <!-- Desktop Navigation Buttons -->
                <nav class="hidden lg:flex flex-wrap justify-center items-center gap-x-3 sm:gap-x-4 md:gap-x-6">
                    <a id="btn-home" class="main-nav-button cursor-pointer">Inicio</a>
                    <a id="btn-liturgy" class="main-nav-button cursor-pointer">Liturgia</a>
                    <a href="https://www.bibleserver.com/es/NVI/G%C3%A9nesis1" target="_blank" rel="noopener noreferrer" class="main-nav-button">Biblia</a>
                    <a id="btn-glossary" class="main-nav-button cursor-pointer">Libro de Oración Común</a>
                    <a id="btn-lectionary" class="main-nav-button cursor-pointer">Leccionario</a>
                    <a href="https://www.bibleserver.com/nicodemus-ai" target="_blank" rel="noopener noreferrer" class="main-nav-button">Nicodemus IA</a>
                    <a id="btn-upload-logo" class="main-nav-button cursor-pointer">
                        <svg class="w-6 h-6 text-gray-600 hover:text-teal-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </a>
                </nav>
                <!-- Mobile Menu Button -->
                <div class="lg:hidden flex items-center">
                    <button id="hamburger-btn" class="p-2 rounded-md text-gray-600 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-teal-500">
                        <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <input type="file" id="logo-uploader" class="hidden" accept="image/*">

        <div id="home-view" class="min-h-[85vh]">
            <!-- This div is intentionally empty to show the body background -->
        </div>

        <div id="liturgy-view" class="hidden">
            <main class="container mx-auto p-4">
                <div class="bg-white/80 backdrop-blur-sm p-4 sm:p-6 rounded-lg shadow-2xl">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center border-b-2 border-amber-400 pb-3">Calendario Litúrgico 2025</h2>
                    <div id="liturgical-cards-container" class="space-y-4">
                        <!-- Liturgical cards will be inserted here by JavaScript -->
                    </div>
                </div>
            </main>
        </div>

        <div id="glossary-view" class="hidden">
            <main class="container mx-auto p-4 md:p-8">
                <div class="bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl sm:text-3xl font-bold border-b-2 border-amber-400 pb-2 mb-6 text-gray-800">Libro de Oración Común (2019)</h2>
                    <div class="mt-8 text-center bg-stone-100 p-6 sm:p-8 rounded-lg shadow">
                        <p class="text-lg text-gray-700 mb-4">Para acceder a los recursos del Libro de Oración Común, por favor haz clic en el siguiente botón. El sitio se abrirá en una nueva pestaña del navegador.</p>
                        <a href="https://bcp2019.anglicanchurch.net/index.php/downloads-espanol/" target="_blank" rel="noopener noreferrer" class="inline-block bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors shadow-md">
                            Ir a Recursos ACNA
                        </a>
                    </div>
                </div>
            </main>
        </div>

        <div id="lectionary-view" class="hidden">
            <main class="container mx-auto p-4 md:p-8">
                <div class="bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl sm:text-3xl font-bold border-b-2 border-amber-400 pb-2 mb-6 text-gray-800">Oficio Diario - Leccionario (Año Uno)</h2>
                    <div id="lectionary-controls">
                        <h3 id="current-month-year"></h3>
                        <select id="month-selector"></select>
                    </div>
                    <div id="lectionary-day-grid-container"></div>
                </div>
            </main>
        </div>
        
        <footer class="bg-gray-800/90 text-white py-6 px-4">
            <div class="container mx-auto text-center">
                <p>&copy; 2025 IBCG APP. Todos los derechos reservados.</p>
                <p class="text-sm text-gray-400 mt-2">Textos litúrgicos del Misal Romano. Textos bíblicos de la Conferencia Episcopal Española.</p>
            </div>
        </footer>
    </div>

    <div id="full-liturgy-view" class="hidden">
        <header id="full-liturgy-header" class="sticky top-0 bg-white/95 backdrop-blur-sm shadow-md z-10">
            <div class="container mx-auto flex items-center justify-between p-2 sm:p-4">
                <button id="back-to-calendar-btn" title="Volver al calendario" class="flex-shrink-0 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    <span class="hidden sm:inline font-semibold text-base">Volver</span>
                </button>
                <div class="flex-grow text-center min-w-0 px-2">
                    <h1 id="full-liturgy-title" class="text-sm sm:text-base md:text-lg font-bold text-gray-800 truncate"></h1>
                    <p id="full-liturgy-subtitle" class="text-xs text-gray-600 truncate"></p>
                </div>
                <div class="flex-shrink-0 flex items-center gap-2 sm:gap-4">
                    <button id="download-docx-btn" title="Descargar como DOCX" class="text-gray-600 hover:text-gray-900 transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    </button>
                    <button id="print-btn" title="Imprimir Liturgia" class="text-gray-600 hover:text-gray-900 transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                    </button>
                </div>
            </div>
        </header>
        <main id="full-liturgy-content" class="container mx-auto p-4 md:p-8">
            
</main>
    </div>

    <!-- Popups -->
    <div id="theology-popup-overlay"></div>
    <div id="theology-popup">
        <span id="popup-close">&times;</span>
        <div id="popup-content-theology"></div>
    </div>

    <div id="lectionary-popup-overlay" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-40 transition-opacity duration-300"></div>
    <div id="lectionary-popup" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-11/12 max-w-2xl bg-white rounded-lg shadow-2xl z-50 max-h-[90vh] flex flex-col transition-transform duration-300 scale-95">
        <header class="flex items-center justify-between p-4 border-b flex-shrink-0">
            <h3 id="lectionary-popup-title" class="text-lg font-bold text-gray-800"></h3>
            <button id="lectionary-popup-close" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
        </header>
        <div id="lectionary-popup-body" class="p-6 overflow-y-auto">
            <!-- Readings will be injected here -->
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- HELPER FUNCTIONS ---
            const addDays = (d, days) => { const res = new Date(d); res.setDate(d.getDate() + days); return res; };

            // --- THEOLOGICAL DATA & HELPERS (GLOBAL SCOPE) ---
            const terms = {
                // Terms for Liturgy
                hypostasis: {original: "ὑπόσταις", transliteration: "hypóstasis", meaning: "Sustancia, fundamento, garantía. En este contexto, la fe es la realidad fundamental de lo que se espera."},
                elenchos: {original: "ἔλεγχos", transliteration: "élenchos", meaning: "Prueba, convicción. La fe proporciona una certeza interior sobre realidades que no se ven."},
                epangelia: {original: "ἐπαγγελία", transliteration: "epangelía", meaning: "Promesa. Un compromiso divino que es el objeto de la esperanza y la fe del creyente."},
                poimnion: {original: "ποίμνιον", transliteration: "poímnion", meaning: "Rebaño pequeño. Término de cariño y ternura que Jesús usa para sus discípulos, destacando su vulnerabilidad y la protección de Dios."},
                kardia: {original: "καρδία", transliteration: "kardía", meaning: "Corazón. En la Biblia, no es solo el asiento de las emociones, sino el centro del intelecto, la voluntad y toda la persona."},
                gregoreō: {original: "γρηγορέω", transliteration: "grēgoreō", meaning: "Velar, estar despierto. Una actitud de alerta espiritual y preparación constante para la venida del Señor."},
                doulos: {original: "δοῦλος", transliteration: "doûlos", meaning: "Siervo, esclavo. Describe la total devoción y obediencia a un amo; en el Nuevo Testamento, se usa para la relación del creyente con Cristo."}
            };
            const ref = (key, num) => `<span class="ref-link" data-term='${JSON.stringify(terms[key]).replace(/'/g, "&#39;")}'><sup>${num}</sup></span>`;

            // --- COMPLETE LITURGICAL DATA GENERATOR ---
            function getLiturgyForDate(date) {
                const year = date.getFullYear();
                if (year !== 2025) return null;

                const toYYYYMMDD = d => `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                const dateString = toYYYYMMDD(date);
                
                // --- Key Liturgical Dates for 2025 (Cycle C) ---
                const firstSundayOfAdvent2024 = new Date(2024, 11, 1);
                const christmasDay = new Date(2025, 11, 25);
                const epiphanySunday = new Date(2025, 0, 5);
                const baptismOfTheLord = new Date(2025, 0, 12);
                const ashWednesday = new Date(2025, 2, 5);
                const easter = new Date(2025, 3, 20);
                const pentecost = new Date(2025, 5, 8);
                const trinitySunday = new Date(2025, 5, 15);
                const christTheKing = new Date(2025, 10, 23);
                const firstSundayOfAdvent2025 = new Date(2025, 10, 30);

                // Helper to count Sundays between two dates (inclusive of start)
                const countSundays = (start, end) => {
                    let count = 0;
                    let current = new Date(start);
                    while (current <= end) {
                        if (current.getDay() === 0) {
                            count++;
                        }
                        current.setDate(current.getDate() + 1);
                    }
                    return count;
                };

                let season = '';
                let seasonColor = '#16a34a'; // Default green
                let title = '';
                let cycle = 'Ciclo C';

                // Determine Season
                if (date >= firstSundayOfAdvent2025) {
                    season = 'Advent'; seasonColor = '#6d28d9';
                } else if (date >= pentecost) {
                    season = 'Season after Pentecost'; seasonColor = '#16a34a';
                } else if (date >= easter) {
                    season = 'Easter'; seasonColor = '#f59e0b';
                } else if (date >= ashWednesday) {
                    season = 'Lent'; seasonColor = '#9333ea';
                } else if (date > epiphanySunday) {
                    season = 'Season after Epiphany'; seasonColor = '#16a34a';
                } else if (date >= new Date(2024, 11, 25)) {
                    season = 'Christmas'; seasonColor = '#ca8a04';
                } else {
                    season = 'Advent'; seasonColor = '#6d28d9';
                }

                const placeholderReadings = {
                    firstReading: { ref: 'Lectura I', text: 'Texto de la primera lectura no disponible.' },
                    psalm: { ref: 'Salmo Responsorial', response: 'Respuesta del salmo.', stanzas: ['Estrofa del salmo no disponible.'] },
                    secondReading: { ref: 'Lectura II', text: 'Texto de la segunda lectura no disponible.' },
                    alleluiaVerse: 'Versículo del Aleluya no disponible.',
                    gospel: { ref: 'Evangelio', text: 'Texto del Evangelio no disponible.' }
                };

                // --- SOLEMNITIES AND FEASTS (OVERRIDE SUNDAY LOGIC) ---
                const solemnities = {
                    '2025-01-01': { title: 'La Circuncisión y Santo Nombre de Nuestro Señor Jesucristo', color: '#e5e7eb' },
                    '2025-01-06': { title: 'La Epifanía de Nuestro Señor Jesucristo', color: '#e5e7eb' },
                    '2025-03-05': { title: 'Miércoles de Ceniza', color: '#9333ea' },
                    '2025-04-17': { title: 'Jueves Santo', color: '#e5e7eb' },
                    '2025-04-18': { title: 'Viernes Santo', color: '#dc2626' },
                    '2025-04-19': { title: 'Sábado Santo', color: '#e5e7eb' },
                    '2025-08-15': { title: 'Santa María Virgen, Madre de Nuestro Señor Jesucristo', color: '#e5e7eb' },
                    '2025-11-01': { title: 'Día de Todos los Santos', color: '#e5e7eb' },
                    '2025-12-25': { title: 'El Día de Navidad', color: '#f59e0b' },
                };

                if (solemnities[dateString]) {
                    title = solemnities[dateString].title;
                    seasonColor = solemnities[dateString].color;
                    cycle = 'Día Santo';
                }

                // --- SUNDAY TITLES (LOC 2019) ---
                if (date.getDay() === 0 && !title) {
                    const ordinals = ["Primer", "Segundo", "Tercer", "Cuarto", "Quinto", "Sexto", "Séptimo", "Octavo", "Noveno", "Décimo"];

                    if (date >= firstSundayOfAdvent2025) {
                        const sundayIndex = countSundays(firstSundayOfAdvent2025, date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo de Adviento`;
                    } else if (date.getTime() === christTheKing.getTime()) {
                        title = 'El Último Domingo después de Pentecostés: Cristo Rey';
                    } else if (date.getTime() === trinitySunday.getTime()) {
                        title = "El Domingo de la Santísima Trinidad";
                    } else if (date > trinitySunday) {
                        const sundayIndex = countSundays(trinitySunday, date);
                        title = `El ${ordinals[sundayIndex] || (sundayIndex + 1) + 'º'} Domingo después de Pentecostés`;
                    } else if (date.getTime() === pentecost.getTime()) {
                        title = 'El Día de Pentecostés';
                    } else if (date.getTime() === easter.getTime()) {
                        title = 'Domingo de Pascua';
                    } else if (date > easter) {
                        const sundayIndex = countSundays(easter, date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo de Pascua`;
                    } else if (date.getTime() === addDays(ashWednesday, 46).getTime()) { // Palm Sunday
                        title = 'Domingo de Ramos: La Pasión del Señor';
                        seasonColor = '#dc2626';
                    } else if (date > ashWednesday) {
                        const sundayIndex = countSundays(addDays(ashWednesday, 4), date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo de Cuaresma`;
                    } else if (date.getTime() === baptismOfTheLord.getTime()) {
                        title = 'El Bautismo de Nuestro Señor Jesucristo';
                    } else if (date > epiphanySunday) {
                        const sundayIndex = countSundays(epiphanySunday, date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo después de la Epifanía`;
                    } else if (date > new Date(2024, 11, 25)) {
                        title = 'El Primer Domingo después de Navidad';
                    } else if (date >= firstSundayOfAdvent2024) {
                        const sundayIndex = countSundays(firstSundayOfAdvent2024, date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo de Adviento`;
                    }
                }

                if (!title) return null;

                let liturgy = {
                    title: title,
                    cycle: cycle,
                    omitGloria: (season === 'Advent' || season === 'Lent'),
                    omitAlleluia: (season === 'Lent'),
                    seasonColor: seasonColor,
                    prayers: {},
                    readings: placeholderReadings
                };

                // Specific data for the example date
                if (dateString === '2025-08-10') {
                    liturgy.prayers = {
                        collect: 'Dios todopoderoso y eterno, a quien podemos llamar Padre, aumenta en nuestros corações el espíritu de hijos adoptivos, para que merezcamos entrar un día en la herencia prometida. Por nuestro Señor Jesucristo.',
                        offerings: 'Sé propicio, Señor, a tu pueblo y acepta con bondad estas ofrendas, para que, con la ayuda de tu piedad, a cada uno le aproveche para su salvación lo que ofrece en honor de tu nombre. Por Jesucristo, nuestro Señor.',
                        postCommunion: 'Que la comunión en tus sacramentos nos salve, Señor, y nos afiance en la luz de tu verdad. Por Jesucristo, nuestro Señor.',
                        preface: 'En verdad es justo y necesario, es nuestro deber y salvación darte gracias siempre y en todo lugar, Señor, Padre santo, Dios todopoderoso y eterno. Pues, aunque no necesitas nuestra alabanza, es don tuyo que seamos agradecidos; y aunque nuestras bendiciones no aumentan tu gloria, nos aprovechan para nuestra salvación. Por Cristo, Señor nuestro. Por eso, unidos a los ángeles, te aclamamos llenos de alegría:'
                    };
                    liturgy.readings = {
                        firstReading: { ref: 'Sabiduría 18, 6-9', text: `La noche de la liberación fue anunciada de antemano a nuestros padres, para que tuvieran ánimo al conocer con certeza la promesa de la que se fiaban. Tu pueblo esperaba, a la vez, la salvación de los justos y la perdición de los enemigos. Porque con la misma acción que castigaste a los adversarios, nos glorificaste a nosotros, llamándonos a ti. Los santos hijos de los buenos ofrecían sacrificios a escondidas y establecieron de común acuerdo esta ley divina: que los santos compartirían por igual los mismos bienes y peligros; y entonaron los himnos de los padres.` },
                        psalm: { ref: 'Salmo 32', response: 'Dichoso el pueblo que el Señor se escogió como heredad.', stanzas: [ `Aclamad, justos, al Señor,<br>que merece la alabanza de los buenos.<br>Dichosa la nación cuyo Dios es el Señor,<br>el pueblo que él se escogió como heredad.`, `El Señor mira desde el cielo,<br>se fija en todos los hombres.<br>Desde su morada observa<br>a todos los habitantes de la tierra.`, `Los ojos del Señor están puestos en quien lo teme,<br>en los que esperan en su misericordia,<br>para librar sus vidas de la muerte<br>y reanimarlos en tiempo de hambre.`, `Nosotros aguardamos al Señor:<br>él es nuestro auxilio y escudo;<br>que tu misericordia, Señor, venga sobre nosotros,<br>como lo esperamos de ti.` ] },
                        secondReading: { ref: 'Hebreos 11, 1-2. 8-19', text: `Hermanos: La fe es garantía${ref('hypostasis', 1)} de lo que se espera, la prueba${ref('elenchos', 2)} de las realidades que no se ven. Por ella fueron alabados nuestros mayores. Por la fe, Abrahán, al ser llamado por Dios, obedeció y salió para el lugar que había de recibir en herencia, y salió sin saber a dónde iba. Por la fe, se estableció en la tierra prometida como en tierra extraña, viviendo en tiendas, y lo mismo Isaac y Jacob, herederos de la misma promesa${ref('epangelia', 3)}, pues esperaba la ciudad de sólidos cimientos, cuyo arquitecto y constructor es Dios. Por la fe, también Sara, siendo estéril, obtuvo vigor para concebir, a pesar de su edad avanzada, porque creyó que era fiel el que se lo prometía. Y así, de un solo hombre, y ya marcado por la muerte, nacieron hijos, numerosos como las estrellas del cielo e incontables como la arena de las playas. Con fe murieron todos estos, sin haber recibido las promesas; las vieron y las saludaron de lejos, confesando que eran extraños y peregrinos en la terra. Los que así hablan, dan a entender que buscan una patria; pues si hubieran pensado en la que habían abandonado, tenían ocasión de volver. Pero ellos ansiaban una patria mejor, la celestial. Por eso Dios no se avergenza de llamarse su Dios, pues les tenía preparada una ciudad. Por la fe, Abrahán, puesto a prueba, ofreció a Isaac; y el que había recibido las promesas, ofrecía a su unigénito, a quien se le había dicho: «La descendencia que lleve tu nombre será la de Isaac». Pero Abrahán pensaba que Dios tiene poder hasta para resucitar de entre los muertos, de donde en cierto sentido lo recobró.` },
                        alleluiaVerse: 'Estad en vela y preparados, porque a la hora que menos penséis viene el Hijo del hombre. (cf. Mt 24, 42a. 44)',
                        gospel: { ref: 'Lucas 12, 32-48', text: `En aquel tiempo, dijo Jesús a sus discípulos: «No temas, pequeño rebaño${ref('poimnion', 4)}, porque vuestro Padre ha tenido a bien daros el reino. Vended vuestros bienes y dad limosna. Haceos bolsas que no se estropeen, un tesoro inagotable en el cielo, adonde no se acercan los ladrones ni roe la polilla. Porque donde está vuestro tesoro, allí estará también vuestro corazón${ref('kardia', 5)}. Tened ceñida la cintura y encendidas las lámparas. Vosotros estad como los hombres que aguardan a que su señor vuelva de la boda, para abrirle apenas venga y llame. Bienaventurados aquellos criados a quienes el señor, al llegar, los encuentre en vela${ref('gregoreō', 6)}; en verdad os digo que se ceñirá, los hará sentar a la mesa y, acercándose, les irá sirviendo. Y, si llega a la segunda vigilia o a la tercera y los encuentra así, ¡bienaventurados ellos! Comprended que si supiera el dueño de casa a qué hora viene el ladrón, no le dejaría abrir un boquete en su casa. Lo mismo vosotros, estad preparados, porque a la hora que menos penséis viene el Hijo del hombre». Pedro le dijo: «Señor, ¿dices esta parábola por nosotros o por todos?». Y el Señor dijo: «¿Quién es el administrador fiel y prudente a quien el señor pondrá al frente de su servidumbre para que reparta la ración de alimento a sus horas? Bienaventurado aquel siervo${ref('doulos', 7)} a quien su señor, al llegar, lo encuentre portándose así. En verdad os digo que lo pondrá al frente de todos sus bienes. Pero si aquel siervo dijere para sus adentros: “Mi señor tarda en llegar”, y empieza a pegarles a los criados y a las criadas, a comer y beber y emborracharse, vendrá el señor de ese siervo el día que menos lo espera y a la hora que no sabe y lo castigará con rigor, y le asignará la suerte de los infieles. El siervo que, conociendo la voluntad de su señor, no se prepara ni obra de acuerdo con su voluntad, recibirá muchos azotes; pero el que, sin conocerla, ha hecho algo digno de azotes, recibirá menos. A quien mucho se le dio, mucho se le reclamará; a quien mucho se le confió, más aún se le pedirá».` }
                    };
                }

                return liturgy;
            }
            
            // --- DOM ELEMENTS & STATE ---
            const splashScreen = document.getElementById('splash-screen');
            const mainContent = document.getElementById('main-content');
            const fullLiturgyView = document.getElementById('full-liturgy-view');
            const backToCalendarBtn = document.getElementById('back-to-calendar-btn');
            const printBtn = document.getElementById('print-btn');
            const downloadDocxBtn = document.getElementById('download-docx-btn');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            const mobileNavLinks = document.getElementById('mobile-nav-links');
            const mainNavButtons = { 
                home: document.getElementById('btn-home'),
                liturgy: document.getElementById('btn-liturgy'), 
                glossary: document.getElementById('btn-glossary'), 
                lectionary: document.getElementById('btn-lectionary')
            };
            const views = { 
                home: document.getElementById('home-view'),
                liturgy: document.getElementById('liturgy-view'), 
                glossary: document.getElementById('glossary-view'), 
                lectionary: document.getElementById('lectionary-view')
            };
            
            const fullLiturgyUI = { title: document.getElementById('full-liturgy-title'), subtitle: document.getElementById('full-liturgy-subtitle'), content: document.getElementById('full-liturgy-content') };
            const uploadLogoBtn = document.getElementById('btn-upload-logo');
            const logoUploader = document.getElementById('logo-uploader');
            const logoImage = document.getElementById('logo-image');
            
            const theologyPopup = document.getElementById('theology-popup');
            const theologyPopupOverlay = document.getElementById('theology-popup-overlay');
            const theologyPopupContent = document.getElementById('popup-content-theology');
            const theologyPopupClose = document.getElementById('popup-close');
            
            const lectionaryControls = document.getElementById('lectionary-controls');
            const monthSelector = document.getElementById('month-selector');
            const currentMonthYear = document.getElementById('current-month-year');
            const lectionaryDayGridContainer = document.getElementById('lectionary-day-grid-container');
            const lectionaryPopup = document.getElementById('lectionary-popup');
            const lectionaryPopupOverlay = document.getElementById('lectionary-popup-overlay');
            const lectionaryPopupTitle = document.getElementById('lectionary-popup-title');
            const lectionaryPopupBody = document.getElementById('lectionary-popup-body');
            const lectionaryPopupClose = document.getElementById('lectionary-popup-close');
            const cardsContainer = document.getElementById('liturgical-cards-container');

            // --- FUNCTIONS ---
            function switchView(viewName) {
                Object.values(views).forEach(v => v.classList.add('hidden'));
                Object.values(mainNavButtons).forEach(b => b.classList.remove('active-nav'));
                if (views[viewName]) {
                    views[viewName].classList.remove('hidden');
                }
                if (mainNavButtons[viewName]) {
                    mainNavButtons[viewName].classList.add('active-nav');
                }
            }
            
            function renderLiturgicalCards() {
                cardsContainer.innerHTML = '';
                const startDate = new Date(2025, 0, 1);
                const endDate = new Date(2025, 11, 31);

                for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                    const liturgyData = getLiturgyForDate(new Date(d));
                    if (liturgyData) {
                        const card = document.createElement('div');
                        card.className = 'liturgical-card flex items-center p-4 rounded-lg shadow-md cursor-pointer';
                        card.style.borderColor = liturgyData.seasonColor;
                        card.dataset.date = d.toISOString().split('T')[0];
                        
                        card.innerHTML = `
                            <div class="flex-shrink-0 w-20 text-center">
                                <p class="text-gray-500 text-sm">${d.toLocaleDateString('es-ES', { weekday: 'short' }).replace('.', '')}</p>
                                <p class="text-2xl font-bold text-gray-800">${d.getDate()}</p>
                                <p class="text-gray-500 text-sm">${d.toLocaleDateString('es-ES', { month: 'short' }).replace('.', '')}</p>
                            </div>
                            <div class="flex-grow pl-4">
                                <h3 class="font-bold text-lg text-gray-900">${liturgyData.title}</h3>
                                <p class="text-sm text-gray-600">${liturgyData.cycle}</p>
                            </div>
                            <div class="flex-shrink-0">
                               <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        `;
                        cardsContainer.appendChild(card);
                    }
                }
            }

            function showFullLiturgy(date) {
                renderFullLiturgyView(date); 
                mainContent.classList.add('hidden');
                fullLiturgyView.classList.remove('hidden');
                fullLiturgyView.scrollTop = 0;
            }

            function renderFullLiturgyView(date) {
                const liturgy = getLiturgyForDate(date);
                if (liturgy && liturgy.readings && liturgy.readings.firstReading.text !== 'Texto de la primera lectura no disponible.') {
                    fullLiturgyUI.title.textContent = liturgy.title;
                    const formattedDate = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    fullLiturgyUI.subtitle.textContent = `${formattedDate} | ${liturgy.cycle}`;
                    
                    const templates = {
                        initialGreeting: `<h3>Saludo Inicial</h3><p class="liturgy-text">En el nombre del Padre, y del Hijo, y del Espíritu Santo.<br><strong>Amén.</strong><br>La gracia de nuestro Señor Jesucristo, el amor del Padre y la comunión del Espíritu Santo esté con todos ustedes.<br><strong>Y con tu espíritu.</strong></p>`,
                        penitentialAct: `<h3>Acto Penitencial (Libro de Oración Común ACNA)</h3><p class="liturgy-text">Amados en el Señor, acerquémonos con un corazón penitente y obediente a la Palabra de Dios, confesando nuestros pecados para que podamos recibir el perdón por su infinita bondad y misericordia.<br><em>Se guarda un momento de silencio.</em><br><strong>Misericordiosísimo Dios, confesamos que hemos pecado contra ti en pensamiento, palabra y obra, por lo que hemos hecho y por lo que hemos dejado de hacer. No te hemos amado con todo nuestro corazón; no hemos amado a nuestro prójimo como a nosotros mismos. Lo sentimos de veras y nos arrepentimos humildemente. Por tu Hijo Jesucristo, ten misericordia de nosotros y perdónanos, para que nos deleitemos en tu voluntad y andemos en tus caminos, para la gloria de tu Nombre. Amén.</strong><br>Dios todopoderoso tenga misericordia de nosotros, perdone nuestros pecados y nos lleve a la vida eterna.<br><strong>Amén.</strong></p>`,
                        gloria: `<h3>Gloria</h3><p class="liturgy-text"><strong>Gloria a Dios en el cielo, y en la tierra paz a los hombres que ama el Señor. Por tu inmensa gloria te alabamos, te bendecimos, te adoramos, te glorificamos, te damos gracias, Señor Dios, Rey celestial, Dios Padre todopoderoso. Señor, Hijo único, Jesucristo. Señor Dios, Cordero de Dios, Hijo del Padre; tú que quitas el pecado del mundo, ten piedad de nosotros; tú que quitas el pecado del mundo, atiende nuestra súplica; tú que estás sentado a la derecha del Padre, ten piedad de nosotros. Porque sólo tú eres Santo, sólo tú Señor, sólo tú Altísimo, Jesucristo, con el Espíritu Santo en la gloria de Dios Padre. Amén.</strong></p>`,
                        alleluia: (verse) => `<h3>Aleluya</h3><p class="liturgy-text"><strong>Aleluya, aleluya.</strong><br>${verse}<br><strong>Aleluya.</strong></p>`,
                        gospelAcclamation: (verse) => `<h3>Aclamación antes del Evangelio</h3><p class="liturgy-text">${verse}</p>`,
                        gospel: (gospelData) => `<h3>Evangelio: ${gospelData.ref}</h3><p class="liturgy-text">El Señor esté con ustedes.<br><strong>Y con tu espíritu.</strong><br>Lectura del santo Evangelio según san ${gospelData.ref.split(' ')[0]}.<br><strong>Gloria a ti, Señor.</strong></p><p class="liturgy-text">${gospelData.text}</p><p class="liturgy-text">Palabra del Señor.<br><strong>Gloria a ti, Señor Jesús.</strong></p>`,
                        credo: `<h3>Profesión de Fe - Credo Niceno</h3><p class="liturgy-text"><strong>Creo en un solo Dios, Padre todopoderoso, Creador del cielo y de la tierra, de todo lo visible y lo invisible. Creo en un solo Señor, Jesucristo, Hijo único de Dios, nacido del Padre antes de todos los siglos: Dios de Dios, Luz de Luz, Dios verdadero de Dios verdadero, engendrado, no creado, de la misma naturaleza del Padre, por quien todo fue hecho; que por nosotros, los hombres, y por nuestra salvation bajó del cielo, y por obra del Espíritu Santo se encarnó de María, la Virgen, y se hizo hombre; y por nuestra causa fue crucificado en tiempos de Poncio Pilato; padeció y fue sepultado, y resucitó al tercer día, según las Escrituras, y subió al cielo, y está sentado a la derecha del Padre; y de nuevo vendrá con gloria para juzgar a vivos y muertos, y su reino no tendrá fin. Creo en el Espíritu Santo, Señor y dador de vida, que procede del Padre y del Hijo, que con el Padre y del Hijo recibe una misma adoración y gloria, y que habló por los profetas. Creo en la Iglesia, que es una, santa, católica и apostólica. Confieso que hay un solo bautismo para el perdón de los pecados. Espero la resurrección de los muertos y la vida del mundo futuro. Amén.</strong></p>`,
                        prayerOfTheFaithful: `<h3>Oración de los Fieles</h3><p class="liturgy-text">Hermanos, oremos a Dios Padre todopoderoso, que escucha siempre la oración de sus hijos. Digamos con fe:<br><strong>Te rogamos, óyenos.</strong><br><em>(Se presentan las intenciones)</em><br>Escucha, Padre, nuestra oración y concédenos aquellos dones que con fe te pedimos. Por Jesucristo, nuestro Señor.<br><strong>Amén.</strong></p>`,
                        eucharisticPrayerII: (preface) => `<h3>Plegaria Eucarística II</h3><p class="liturgy-text">El Señor esté con ustedes.<br><strong>Y con tu espíritu.</strong><br>Levantemos el corazón.<br><strong>Lo tenemos levantado hacia el Señor.</strong><br>Demos gracias al Señor, nuestro Dios.<br><strong>Es justo y necesario.</strong></p><p class="liturgy-text">${preface}</p><p class="liturgy-text"><strong>Santo, Santo, Santo es el Señor, Dios del Universo. Llenos están el cielo y la tierra de tu gloria. Hosanna en el cielo. Bendito el que viene en nombre del Señor. Hosanna en el cielo.</strong></p><p class="liturgy-text">Santo eres en verdad, Señor, fuente de toda santidad; por eso te pedimos que santifiques estos dones con la efusión de tu Espíritu, de manera que se conviertan para nosotros en el Cuerpo y la Sangre de Jesucristo, nuestro Señor. El cual, cuando iba a ser entregado a su Pasión, voluntariamente aceptada, tomó pan, dándote gracias, lo partió y lo dio a sus discípulos, diciendo: <strong>«TOMEN Y COMAN TODOS DE ÉL, PORQUE ESTO ES MI CUERPO, QUE SERÁ ENTREGADO POR USTEDES».</strong> Del mismo modo, acabada la cena, tomó el cáliz, y, dándote gracias de nuevo, lo pasó a sus discípulos, diciendo: <strong>«TOMEN Y BEBAN TODOS DE ÉL, PORQUE ESTE ES EL CÁLIZ DE MI SANGRE, SANGRE DE LA ALIANZA NUEVA Y ETERNA, QUE SERÁ DERRAMADA POR USTEDES Y POR MUCHOS PARA EL PERDÓN DE LOS PECADOS. HAGAN ESTO EN CONMEMORACIÓN MÍA».</strong> Este es el Misterio de la fe.<br><strong>Anunciamos tu muerte, proclamamos tu resurrección. ¡Ven, Señor Jesús!</strong></p><p class="liturgy-text">Así, pues, Padre, al celebrar ahora el memorial de la muerte y resurrección de tu Hijo, te ofrecemos el pan de vida y el cáliz de salvación, y te damos gracias porque nos haces dignos de servirte en tu presencia. Te pedimos humildemente que el Espíritu Santo congregue en la unidad a cuantos participamos del Cuerpo y la Sangre de Cristo. Por Cristo, con él y en él, a ti, Dios Padre omnipotente, en la unidad del Espíritu Santo, todo honor y toda gloria por los siglos de los siglos.<br><strong>Amén.</strong></p>`,
                        communionRite: `<h3>Rito de la Comunión</h3><p class="liturgy-text">Fieles a la recomendación del Salvador y siguiendo su divina enseñanza, nos atrevemos a decir:<br><strong>Padre nuestro, que estás en el cielo, santificado sea tu Nombre; venga a nosotros tu reino; hágase tu voluntad en la tierra como en el cielo. Danos hoy nuestro pan de cada día; perdona nuestras ofensas, como también nosotros perdonamos a los que nos ofenden; no nos dejes caer en la tentación, y líbranos del mal.</strong><br>Líbranos de todos los males, Señor, y concédenos la paz en nuestros días, para que, ayudados por tu misericordia, vivamos siempre libres de pecado y protegidos de toda perturbación, mientras esperamos la gloriosa venida de nuestro Salvador Jesucristo.<br><strong>Tuyo es el reino, tuyo el poder y la gloria, por siempre, Señor.</strong><br>Señor Jesucristo, que dijiste a tus apóstoles: «La paz les dejo, mi paz les doy», no tengas en cuenta nossos pecados, sino la fe de tu Iglesia y, conforme a tu palabra, concédele la paz y la unidad. Tú que vives y reinas por los siglos de los siglos.<br><strong>Amén.</strong><br>La paz del Señor esté siempre con ustedes.<br><strong>Y con tu espíritu.</strong></p><p class="liturgy-text"><strong>Cordero de Dios, que quitas el pecado del mundo, ten piedad de nosotros.</strong><br><strong>Cordero de Dios, que quitas el pecado del mundo, ten piedad de nosotros.</strong><br><strong>Cordero de Dios, que quitas el pecado del mundo, danos la paz.</strong></p><p class="liturgy-text">Este es el Cordero de Dios, que quita el pecado del mundo. Dichosos los invitados a la cena del Señor.<br><strong>Señor, no soy digno de que entres en mi casa, pero una palabra tuya bastará para sanarme.</strong></p>`,
                        acnaPostCommunion: `<h3>Oración después de la Comunión (ACNA)</h3><p class="liturgy-text"><strong>Padre Celestial, te damos gracias por alimentarnos con el alimento espiritual del preciosísimo Cuerpo y Sangre de tu Hijo nuestro Salvador Jesucristo; y por asegurarnos en estos santos misterios que somos miembros vivos de tu Hijo y herederos de tu reino eterno. Y te suplicamos, oh Señor, que nos asistas con tu gracia, para que continuemos en esa santa confraternidad, y hagamos todas las buenas obras que has preparado para que andemos en ellas; por Jesucristo nuestro Señor, a quien, contigo y el Espíritu Santo, sea todo honor y gloria, por los siglos de los siglos. Amén.</strong></p>`,
                        concludingRites: `<h3>Rito de Conclusión</h3><p class="liturgy-text">El Señor esté con ustedes.<br><strong>Y con tu espíritu.</strong><br>La bendición de Dios todopoderoso, Padre, Hijo, y Espíritu Santo, descienda sobre ustedes y permaneza para siempre.<br><strong>Amén.</strong><br>Pueden ir en paz.<br><strong>Demos gracias a Dios.</strong></p>`
                    };

                    const entranceProcession = `<h3>Procesión de Entrada</h3><p class="liturgy-text italic">(Se canta un himno o antífona de entrada apropiado)</p>`;
                    const introductoryRites = entranceProcession + templates.initialGreeting + templates.penitentialAct + (liturgy.omitGloria ? '' : templates.gloria) + `<h3>Oración Colecta</h3><p class="liturgy-text">${liturgy.prayers.collect}</p>`;
                    
                    let psalmContentHtml = `<strong>R. ${liturgy.readings.psalm.response}</strong><br><br>` + liturgy.readings.psalm.stanzas.join(`<br><br><strong>R. ${liturgy.readings.psalm.response}</strong><br><br>`);

                    let gospelAcclamationHtml = liturgy.omitAlleluia ? templates.gospelAcclamation(liturgy.readings.gospelAcclamationVerse) : templates.alleluia(liturgy.readings.alleluiaVerse);

                    const liturgyOfTheWord = `<h3>Primera Lectura: ${liturgy.readings.firstReading.ref}</h3><p class="liturgy-text">${liturgy.readings.firstReading.text}</p><h3>Salmo Responsorial: ${liturgy.readings.psalm.ref}</h3><p class="liturgy-text">${psalmContentHtml}</p>${liturgy.readings.secondReading ? `<h3>Segunda Lectura: ${liturgy.readings.secondReading.ref}</h3><p class="liturgy-text">${liturgy.readings.secondReading.text}</p>` : ''}${gospelAcclamationHtml}${templates.gospel(liturgy.readings.gospel)}<h3>Homilía</h3><p class="liturgy-text italic">(Reflexión sobre las lecturas)</p>${templates.credo}${templates.prayerOfTheFaithful}`;
                    
                    const liturgyOfTheEucharist = `<h3>Presentación de las Ofrendas</h3><p class="liturgy-text">Oren, hermanos, para que este sacrificio, mío y de ustedes, sea agradable a Dios, Padre todopoderoso.<br><strong>El Señor reciba de tus manos este sacrificio, para alabanza y gloria de su nombre, para nuestro bien y el de toda su santa Iglesia.</strong></p><h3>Oración sobre las Ofrendas</h3><p class="liturgy-text">${liturgy.prayers.offerings}</p>${templates.eucharisticPrayerII(liturgy.prayers.preface)}${templates.communionRite}`;
                    
                    const concludingRites = `<h3>Oración después de la Comunión</h3><p class="liturgy-text">${liturgy.prayers.postCommunion}</p>${templates.acnaPostCommunion}${templates.concludingRites}`;

                    const finalHtml = `<div class="bg-white p-6 rounded-lg shadow-md">
                                        <div class="liturgy-section"><h2>Ritos Iniciales</h2>${introductoryRites}</div>
                                        <div class="liturgy-section"><h2>Liturgia de la Palabra</h2>${liturgyOfTheWord}</div>
                                        <div class="liturgy-section"><h2>Liturgia Eucarística</h2>${liturgyOfTheEucharist}</div>
                                        <div class="liturgy-section"><h2>Ritos de Conclusión</h2>${concludingRites}</div>
                                    </div>`;

                    fullLiturgyUI.content.innerHTML = finalHtml;

                } else {
                    fullLiturgyUI.title.textContent = 'Liturgia no Disponible';
                    fullLiturgyUI.subtitle.textContent = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    fullLiturgyUI.content.innerHTML = `<div class="bg-white p-8 rounded-lg shadow-md text-center"><p class="text-gray-600 py-16">Lo sentimos, la liturgia completa para este día aún no ha sido implementada.</p></div>`;
                }
            }


            function hideFullLiturgy() {
                mainContent.classList.remove('hidden');
                fullLiturgyView.classList.add('hidden');
            }

            function loadLogoFromStorage() {
                const savedLogo = localStorage.getItem('userLogo');
                if (savedLogo) {
                    logoImage.src = savedLogo;
                }
            }

            // --- THEOLOGY POPUP LOGIC ---
            function showTheologyPopup(event) {
                const refLink = event.target.closest('.ref-link');
                if (refLink) {
                    event.preventDefault();
                    event.stopPropagation();
                    const data = JSON.parse(refLink.dataset.term);
                    
                    let commentaryHtml = data.commentary ? `<hr class="my-3 border-gray-200"><h5 class="text-teal-700 font-bold mt-2">Comentario Teológico</h5><p class="text-sm text-gray-600">${data.commentary}</p>` : '';

                    theologyPopupContent.innerHTML = `
                        <h5 class="text-teal-700 font-bold">${data.transliteration}</h5>
                        <p class="original-term text-gray-700 mb-2">${data.original}</p>
                        <p class="text-gray-800">${data.meaning}</p>
                        ${commentaryHtml}
                    `;
                    
                    theologyPopupOverlay.style.display = 'block';
                    theologyPopup.style.display = 'block';
                    document.body.style.overflow = 'hidden'; 
                }
            }
            
            function closeTheologyPopup() {
                theologyPopup.style.display = 'none';
                theologyPopupOverlay.style.display = 'none';
                document.body.style.overflow = ''; 
            }

            // --- LECTIONARY LOGIC ---
            const dailyCollects = {
                morning: [
                    { title: "Una Colecta por Fortaleza para Esperar el Regreso de Cristo", text: "Oh Dios Rey nuestro, por la resurrección de tu Hijo Jesucristo el primer día de la semana, tú venciste el pecado, hiciste huir la muerte y nos diste la esperanza de la vida eterna: Redime todos nuestros días con esta victoria; perdona nuestros pecados, destierra nuestros miedos, haznos valientes para alabarte y hacer tu voluntad; y fortalécenos para esperar la consumación de tu reino en el último gran día; Por Jesucristo Nuestro Señor. Amén." },
                    { title: "Una Colecta para la Renovación de la Vida", text: "Oh Dios, Rey eterno, que con tu luz separas el día de la noche, y transformas en claridad la sombra de muerte: Arroja de nosotros todo mal deseo, inclina nuestro corazón a guardar tu ley, y guía nuestros pasos por el sendero de la paz; para que, al hacer con gusto tu voluntad durante el día, nos alegre darte gracias cuando llegue la noche; por Jesucristo nuestro Señor. Amén." },
                    { title: "Una Colecta por la Paz", text: "Oh Dios, autor de la paz y amante de la concordia, conocerte es vida eterna, y servirte, plena libertad: Defiende a estos tus humildes siervos de todos los asaltos de nuestros enemigos; para que, confiados en tu protección, no temamos la fuerza de ningún adversario; por el poder de Jesucristo nuestro Señor. Amén." },
                    { title: "Una Colecta por Gracia", text: "Señor Dios, todopoderoso y eterno Padre, nos hiciste llegar sanos y salvos hasta este nuevo día: Consérvanos con tu gran poder, para que no caigamos en pecado, ni nos venza la adversidad; y, en todo lo que hagamos, dirígenos a realizar tus designios; por Jesucristo nuestro Señor. Amén." },
                    { title: "Una Colecta por Guía Divina", text: "Padre celestial, en ti vivimos, nos movemos y tenemos el ser: Te suplicamos humildemente que nos guíes y gobiernes con tu Santo Espíritu, para que en todos los afanes y quehaceres de nuestra vida no te olvidemos, sino que recordemos que siempre caminamos en tu presencia; por Jesucristo Nuestro Señor. Amén." },
                    { title: "Una Colecta por Tenacidad", text: "Dios Todopoderoso, cuyo Hijo muy amado no subió al gozo, sino que primero sufrió dolor, y no entró en la gloria antes de ser crucificado: Concédenos por tu misericordia que, a través del camino de la Cruz, podamos encontrar el mejor sendero de la vida y de la paz; Por Jesucristo tu Hijo nuestro Señor. Amén." },
                    { title: "Una Colecta por el Descanso del Sábado", text: "Dios todopoderoso, que después de la creación del mundo descansaste de todos tus trabajos, y santificaste un día de reposo para todas tus criaturas: Concede que nosotros, apartando toda ansiedad terrenal, nos dispongamos debidamente para el servicio de tu santuario, y que nuestro descanso aquí en la tierra sea una preparación para el reposo eterno en el cielo, que has prometido a tu pueblo; por Jesucristo nuestro Señor. Amén." }
                ],
                evening: [
                    { title: "Una Colecta por la Esperanza de la Resurrección", text: "Señor Dios, cuyo Hijo, nuestro Salvador Jesucristo, triunfó sobre los poderes de la muerte y nos preparó nuestro lugar en la nueva Jerusalén: Concede que nosotros, que hemos dado gracias en este día por su resurrección, te alabemos en esa Ciudad de la cual Él es la luz, y donde vive y reina por los siglos de los siglos. Amén." },
                    { title: "Una Colecta por la Paz", text: "Oh Dios, fuente de todos los deseos santos, de todos los buenos consejos y de todas las obras justas: Da a tus siervos la paz que el mundo no puede dar, para que nuestro corazón esté dispuesto a obedecer tus mandamientos, y para que nosotros, siendo defendidos del miedo a nuestros enemigos, pasemos nuestro tiempo en reposo y tranquilidad; por los méritos de Jesucristo Nuestro Salvador. Amén." },
                    { title: "Una Colecta en los Peligros", text: "Ilumina nuestras tinieblas, te suplicamos, Señor; y por tu gran misericordia, defiéndenos de todas los riesgos y peligros de esta noche; por el amor de tu único Hijo, nuestro Salvador Jesucristo. Amén." },
                    { title: "Una Colecta para Protección", text: "Oh Dios, la vida de todos los que viven, la luz de los fieles, la fuerza de los que trabajan y el reposo de los muertos: Te damos gracias por las bendiciones del día que pasó, y te pedimos humildemente tu protección a través de la noche que viene. Llévanos seguros a las horas de la mañana; por aquel que murió y resucitó por nosotros, tu Hijo, nuestro Salvador Jesucristo. Amén." },
                    { title: "Colecta por la Presencia de Cristo", text: "Señor Jesús, quédate con nosotros, porque la tarde está cerca y el día ha pasado; sé nuestro compañero en el camino, enciende nuestro corazón y despierta la esperanza, para que te conozcamos tal como eres revelado en la Escritura y la fracción del pan. Concédelo por el bien de tu amor. Amén." },
                    { title: "Una Colecta por la Fe", text: "Señor Jesucristo, con tu muerte quitaste el aguijón de la muerte: Concede a tus siervos que sigamos con fe donde tú tienes la guía del camino, para que finalmente podamos dormir en paz en ti y despertar en tu semejanza; por tu tierna misericordia. Amén." },
                    { title: "Una Colecta en Víspera del Culto", text: "Oh Dios, fuente de luz eterna: Derrama tu día eterno sobre nosotros que te cuidamos, para que nuestros labios te alaben, nuestras vidas te bendigan y nuestro culto mañana te dé gloria; Por Jesucristo nuestro Señor. Amén." }
                ]
            };
            const lectionaryData = {
                // Data for August 2025 (Year 1)
                "2025-08-01": { 
                    collect: "Oh Señor, te rogamos que nos concedas un aumento de fe, esperanza y caridad; y, para que obtengamos lo que prometes, haznos amar lo que mandas; por Jesucristo nuestro Señor, que vive y reina contigo y el Espíritu Santo, un solo Dios, por los siglos de los siglos. Amén.",
                    morning: { 
                        psalms: {ref: "Salmo 31", text: "En ti, oh Señor, he puesto mi esperanza; no sea yo avergonzado jamás; líbrame en tu justicia.<br>Inclina a mí tu oído, líbrame pronto; sé para mí una roca de fortaleza, y un baluarte para salvarme.<br>Pues tú eres mi roca y mi castillo; por tu nombre me guiarás y me encaminarás.<br>Sácame de la red que han escondido para mí, pues tú eres mi refugio.<br>En tu mano encomiendo mi espíritu; tú me has redimido, oh Señor, Dios de verdad.<br>He aborrecido a los que esperan en vanidades ilusorias; mas yo en el Señor he esperado.<br>Me gozaré y alegraré en tu misericordia, porque has visto mi aflicción; has conocido mi alma en las angustias.<br>No me entregaste en mano del enemigo; pusiste mis pies en lugar espacioso.<br>Ten misericordia de mí, oh Señor, porque estoy en angustia; se han consumido de tristeza mis ojos, mi alma también y mi cuerpo.<br>Porque mi vida se va gastando de dolor, y mis años de suspirar; se agotan mis fuerzas a causa de mi iniquidad, y mis huesos se han consumido.<br>De todos mis enemigos soy objeto de oprobio, y de mis vecinos en gran manera, y el horror de mis conocidos; los que me ven fuera huyen de mí.<br>He sido olvidado de su corazón como un muerto; he venido a ser como un vaso quebrado.<br>Porque oigo la calumnia de muchos; el miedo me asalta por todas partes, mientras consultan juntos contra mí e idean quitarme la vida.<br>Mas yo en ti confío, oh Señor; digo: Tú eres mi Dios.<br>En tu mano están mis tiempos; líbrame de la mano de mis enemigos y de mis perseguidores.<br>Haz resplandecer tu rostro sobre tu siervo; sálvame por tu misericordia.<br>No sea yo avergonzado, oh Señor, ya que te he invocado; sean avergonzados los impíos, estén mudos en el Seol.<br>Enmudezcan los labios mentirosos, que hablan contra el justo cosas duras, con soberbia y menosprecio.<br>¡Cuán grande es tu bondad, que has guardado para los que te temen, que has mostrado a los que esperan en ti, delante de los hijos de los hombres!<br>En lo secreto de tu presencia los esconderás de la conspiración del hombre; los pondrás en un tabernáculo a cubierto de contención de lenguas.<br>Bendito sea el Señor, porque ha hecho maravillosa su misericordia para conmigo en ciudad fortificada.<br>Decía yo en mi premura: Cortado soy de delante de tus ojos; pero tú oíste la voz de mis ruegos cuando a ti clamaba.<br>Amad al Señor, todos vosotros sus santos; a los fieles guarda el Señor, y paga abundantemente al que procede con soberbia.<br>Esforzaos todos vosotros los que esperáis en el Señor, y tome aliento vuestro corazón."}, 
                        ot: {ref: "1 Samuel 2:11-26", text: "Elcaná, por su parte, se fue a su casa en Ramá. El niño, por su parte, se quedó para servir al Señor bajo el cuidado del sacerdote Elí.<br><br><b>Los hijos malvados de Elí</b><br>Los hijos de Elí eran unos perversos que no tomaban en cuenta al Señor ni la costumbre de los sacerdotes con el pueblo. Cuando alguien ofrecía un sacrificio, mientras se cocía la carne, un criado del sacerdote iba con un tenedor de tres dientes en la mano y lo hundía en la olla, en la cacerola, en el caldero o en la marmita, y todo lo que sacaba el tenedor era para el sacerdote. Así hacían con todo israelita que iba a Siló.<br>Incluso antes de que quemaran la grasa, el criado del sacerdote se presentaba y le decía al que ofrecía el sacrificio: «Dame carne para asársela al sacerdote, porque no te va a aceptar la carne cocida, sino cruda».<br>Si el hombre le respondía: «Deja que primero se queme la grasa, y luego toma todo lo que quieras», el criado le contestaba: «¡No! Dámela ahora mismo; de lo contrario, te la quitaré por la fuerza».<br>El pecado de estos jóvenes era muy grave a los ojos del Señor, pues trataban con desprecio las ofrendas que le pertenecían.<br>El joven Samuel, por su parte, ministraba delante del Señor, vestido con un efod de lino.<br>Cada año su madre le hacía una pequeña túnica y se la llevaba cuando iba con su esposo para ofrecer el sacrificio anual.<br>Y Elí bendecía a Elcaná y a su esposa con estas palabras: «Que el Señor te dé hijos de esta mujer para ocupar el lugar del que ella dedicó al Señor». Después de esto, regresaban a su casa.<br>Y el Señor fue bueno con Ana; ella concibió y dio a luz tres hijos y dos hijas. Mientras tanto, el joven Samuel crecía en la presencia del Señor.<br>Elí, que ya era muy anciano, se enteró de todo lo que sus hijos le hacían a Israel y de que se acostaban con las mujeres que servían a la entrada del santuario.<br>Así que les dijo: «¿Por qué hacen estas cosas? Todo el pueblo me habla de su mala conducta.<br>¡No, hijos míos! No es nada bueno lo que se oye decir de ustedes entre el pueblo del Señor.<br>Si alguien peca contra otra persona, Dios le servirá de árbitro; pero, si peca contra el Señor, ¿quién podrá interceder por él?» Sin embargo, no le hicieron caso a la advertencia de su padre, pues el Señor había resuelto quitarles la vida.<br>Por su parte, el joven Samuel seguía creciendo y ganándose el aprecio del Señor y de la gente."}, 
                        nt: {ref: "Hechos 2:14-36", text: "Entonces Pedro, con los once, se puso de pie y dijo a voz en cuello: «Compatriotas judíos y todos ustedes que están en Jerusalén, déjenme explicarles esto; oigan bien mis palabras.<br>Estos no están borrachos, como suponen ustedes. ¡Apenas son las nueve de la mañana! En realidad, lo que pasa es lo que anunció el profeta Joel:<br>“Sucederá que en los últimos días —dice Dios—, derramaré mi Espíritu sobre todo el género humano. Los hijos y las hijas de ustedes profetizarán, tendrán visiones los jóvenes y sueños los ancianos. En esos días derramaré mi Espíritu aun sobre mis siervos y mis siervas, y profetizarán. Arriba en el cielo y abajo en la tierra mostraré prodigios: sangre, fuego y nubes de humo. El sol se convertirá en tinieblas y la luna en sangre antes que llegue el día del Señor, día grande y glorioso. Y todo el que invoque el nombre del Señor será salvo”.<br>»Pueblo de Israel, escuchen esto: Jesús de Nazaret fue un hombre acreditado por Dios ante ustedes con milagros, señales y prodigios, los cuales Dios hizo entre ustedes por medio de él, como bien lo saben.<br>Este fue entregado según el determinado propósito y el previo conocimiento de Dios; y por medio de gente malvada, ustedes lo mataron, clavándolo en la cruz.<br>Sin embargo, Dios lo resucitó, librándolo de las angustias de la muerte, porque era imposible que la muerte lo mantuviera bajo su dominio.<br>David dijo de él: “Veía yo al Señor siempre delante de mí; porque está a mi derecha, no seré conmovido. Por eso mi corazón se alegra y canta con gozo mi lengua; mi cuerpo también vivirá en esperanza. No dejarás que mi vida termine en el sepulcro; no permitirás que tu Santo sufra corrupción. Me has dado a conocer los caminos de la vida; me llenarás de alegría en tu presencia”.<br>»Hermanos, permítanme hablarles con franqueza sobre el patriarca David, que murió y fue sepultado, y cuyo sepulcro está entre nosotros hasta el día de hoy.<br>Era profeta y sabía que Dios le había prometido bajo juramento poner en el trono a uno de sus descendientes.<br>Viéndolo de antemano, habló de la resurrección del Cristo, que no fue abandonado en el sepulcro ni su cuerpo sufrió corrupción.<br>A este Jesús, Dios lo resucitó, y de ello todos nosotros somos testigos.<br>Exaltado por el poder de Dios, y habiendo recibido del Padre el Espíritu Santo prometido, ha derramado esto que ustedes ahora ven y oyen.<br>Porque David no subió al cielo, y sin embargo declaró: “Dijo el Señor a mi Señor: ‘Siéntate a mi derecha, hasta que ponga a tus enemigos por estrado de tus pies’”.<br>»Por tanto, sépalo bien todo el pueblo de Israel que a este Jesús, a quien ustedes crucificaron, Dios lo ha hecho Señor y Cristo»."} 
                    }, 
                    evening: { 
                        psalms: {ref: "Salmo 35", text: "Disputa, oh Señor, con los que contienden contra mí; pelea contra los que me combaten.<br>Echa mano al escudo y al pavés, y levántate en mi ayuda.<br>Saca la lanza, cierra el paso a mis perseguidores; di a mi alma: Yo soy tu salvación.<br>Sean avergonzados y confundidos los que buscan mi vida; sean vueltos atrás y avergonzados los que mi mal intentan.<br>Sean como el tamo delante del viento, y el ángel del Señor los acose.<br>Sea su camino tenebroso y resbaladizo, y el ángel del Señor los persiga.<br>Porque sin causa escondieron para mí su red en un hoyo; sin causa cavaron hoyo para mi alma.<br>Venga sobre él quebrantamiento sin que lo sepa, y la red que él escondió lo prenda; con quebrantamiento caiga en ella.<br>Entonces mi alma se alegrará en el Señor; se regocijará en su salvación.<br>Todos mis huesos dirán: Señor, ¿quién como tú, que libras al afligido del más fuerte que él, y al pobre y menesteroso del que le despoja?<br>Se levantan testigos malvados; de lo que no sé me preguntan; me devuelven mal por bien, para afligir a mi alma.<br>Pero yo, cuando ellos enfermaron, me vestí de cilicio; afligí con ayuno mi alma, y mi oración se volvía a mi seno.<br>Como por mi compañero, como por mi hermano andaba; como el que trae luto por madre, enlutado me humillaba.<br>Pero ellos se alegraron en mi adversidad, y se juntaron; se juntaron contra mí gentes despreciables, y yo no lo entendía; me despedazaban sin cesar.<br>Como lisonjeros, escarnecedores y truhanes, crujieron contra mí sus dientes.<br>Señor, ¿hasta cuándo verás esto? Rescata mi alma de sus destrucciones, mi única, de los leones.<br>Te confesaré en grande congregación; te alabaré entre numeroso pueblo.<br>No se alegren de mí los que sin causa son mis enemigos, ni los que me aborrecen sin causa guiñen el ojo.<br>Porque no hablan paz; y contra los mansos de la tierra piensan palabras engañosas.<br>Ensancharon sobre mí su boca; dijeron: ¡Ea, ea, nuestros ojos lo han visto!<br>Tú lo has visto, oh Señor; no calles; Señor, no te alejes de mí.<br>Muévete y despierta para hacerme justicia, Dios mío y Señor mío, para defender mi causa.<br>Júzgame conforme a tu justicia, Señor Dios mío, y no se alegren de mí.<br>No digan en su corazón: ¡Ea, alma nuestra! No digan: ¡Le hemos devorado!<br>Sean avergonzados y confundidos a una los que de mi mal se alegran; vístanse de vergüenza y de confusión los que se engrandecen contra mí.<br>Canten y alégrense los que están a favor de mi justa causa, y digan siempre: Sea exaltado el Señor, que ama la paz de su siervo.<br>Y mi lengua hablará de tu justicia y de tu alabanza todo el día."}, 
                        ot: {ref: "1 Samuel 2:27-36", text: "Entonces un hombre de Dios fue a Elí y le dijo: «Así dice el Señor: “¿Acaso no me revelé claramente a la familia de tu padre cuando estaban en Egipto, sometidos a la casa del faraón?<br>De entre todas las tribus de Israel, escogí a tu familia para que fueran mis sacerdotes, subieran a mi altar, quemaran incienso y llevaran el efod en mi presencia. También le concedí a tu familia participar en todas las ofrendas de los israelitas que se queman en mi honor.<br>¿Por qué, pues, tratan con desprecio mis sacrificios y ofrendas? ¿Por qué honras a tus hijos más que a mí, y engordan con lo mejor de todas las ofrendas de mi pueblo Israel?”<br>»Por lo tanto, el Señor, Dios de Israel, declara: “Yo había prometido que tu familia y la de tu padre ministrarían siempre en mi presencia”. Pero ahora el Señor declara: “¡Eso nunca! Yo honro a los que me honran, y desprecio a los que me desprecian.<br>Ciertamente viene la hora en que acabaré con tu poder y con el de tu familia; ninguno de tus descendientes llegará a viejo.<br>Verás la aflicción de mi morada, y aunque yo colme de bienes a Israel, nadie en tu familia llegará jamás a la vejez.<br>A cualquier descendiente tuyo que yo no elimine de mi altar, lo dejaré con vida para que se le consuman los ojos y se le aflija el alma. ¡Pero todos tus descendientes morirán en la flor de la vida!<br>»”Como señal, te doy lo que les va a pasar a tus dos hijos, Ofni y Finees: ambos morirán el mismo día.<br>Entonces me designaré un sacerdote fiel, que actúe según los anhelos de mi corazón. Le daré una descendencia que se mantenga firme, y por siempre ministrará delante de mi ungido.<br>Entonces los sobrevivientes de tu familia vendrán a inclinarse ante él para pedirle una moneda de plata y una hogaza de pan. Le suplicarán: ‘¡Le ruego que me asigne algún puesto sacerdotal para tener algo que comer!’”»"}, 
                        nt: {ref: "Marcos 1:1-13", text: "Principio del evangelio de Jesucristo, el Hijo de Dios.<br>Sucedió como está escrito en el profeta Isaías: «Yo envío mi mensajero delante de ti, el cual preparará tu camino». «Voz de uno que grita en el desierto: “Preparen el camino para el Señor, háganle sendas derechas”».<br>Así se presentó Juan, bautizando en el desierto y predicando el bautismo de arrepentimiento para el perdón de pecados.<br>Toda la gente de la región de Judea y de la ciudad de Jerusalén acudía a él. Cuando confesaban sus pecados, él los bautizaba en el río Jordán.<br>La ropa de Juan era de pelo de camello, y usaba un cinto de cuero en la cintura. Se alimentaba de langostas y miel silvestre.<br>Y este era su mensaje: «Después de mí viene uno más poderoso que yo, que ni siquiera merezco agacharme para desatarle la correa de sus sandalias. Yo los he bautizado a ustedes con agua, pero él los bautizará con el Espíritu Santo».<br>En esos días llegó Jesús desde Nazaret de Galilea y fue bautizado por Juan en el Jordán.<br>En seguida, al subir del agua, Jesús vio que el cielo se rasgaba y que el Espíritu bajaba sobre él como una paloma.<br>Y se oyó una voz del cielo que decía: «Tú eres mi Hijo amado; estoy muy complacido contigo».<br>En seguida el Espíritu lo impulsó a ir al desierto, y allí permaneció cuarenta días, y era tentado por Satanás. Estaba con las fieras, y los ángeles le servían."} 
                    }
                },
                // ... More data for August
                "2025-08-31": { 
                    collect: "Señor de todo poder y majestad, cuyo amor eterno nos ha traído a la vida y nos sostiene en cada momento: Danos tal gratitud por tu bondad que te alabemos no solo con nuestros labios, sino en nuestras vidas, por Jesucristo nuestro Señor. Amén.",
                    morning: { psalms: {ref: "Salmo 120, 121, 122", text: "A ti levanto mis ojos, a ti que habitas en los cielos..."}, ot: {ref: "2 Samuel 7:1-17", text: "Aconteció que cuando ya el rey habitaba en su casa..."}, nt: {ref: "Hechos 13:13-25", text: "Habiendo zarpado de Pafos, Pablo y sus compañeros..."} }, 
                    evening: { psalms: {ref: "Salmo 123, 124, 125", text: "Si no hubiera sido por el Señor, que estuvo por nosotros..."}, ot: {ref: "Isaías 57:14-21", text: "Y se dirá: Allanad, allanad; barred el camino..."}, nt: {ref: "Apocalipsis 3:14-22", text: "Y escribe al ángel de la iglesia en Laodicea..."} }
                }
            };
            const placeholderData = {
                collect: "La colecta para este día aún no está disponible.",
                morning: { psalms: {ref: "Salmos", text: "Aún no disponible"}, ot: {ref: "Antiguo Testamento", text: "Aún no disponible"}, nt: {ref: "Nuevo Testamento", text: "Aún no disponible"} },
                evening: { psalms: {ref: "Salmos", text: "Aún no disponible"}, ot: {ref: "Antiguo Testamento", text: "Aún no disponible"}, nt: {ref: "Nuevo Testamento", text: "Aún no disponible"} }
            };

            function renderLectionaryInterface() {
                const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
                monthSelector.innerHTML = '';
                monthNames.forEach((name, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = name;
                    monthSelector.appendChild(option);
                });

                monthSelector.addEventListener('change', (e) => {
                    const monthIndex = parseInt(e.target.value);
                    renderCalendarForMonth(monthIndex);
                });

                const currentMonth = new Date().getMonth();
                monthSelector.value = currentMonth;
                renderCalendarForMonth(currentMonth);
            }

            function renderCalendarForMonth(monthIndex) {
                const year = 2025;
                const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
                currentMonthYear.textContent = `${monthNames[monthIndex]} ${year}`;
                
                lectionaryDayGridContainer.innerHTML = '';
                const grid = document.createElement('div');
                grid.className = "lectionary-calendar-grid";

                const dayHeaders = ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb"];
                dayHeaders.forEach(day => {
                    const headerCell = document.createElement('div');
                    headerCell.className = 'calendar-header';
                    headerCell.textContent = day;
                    grid.appendChild(headerCell);
                });

                const firstDayOfMonth = new Date(year, monthIndex, 1).getDay();
                const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();

                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = "calendar-day empty";
                    grid.appendChild(emptyCell);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, monthIndex, day);
                    const dateString = `${year}-${String(monthIndex + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    
                    const cell = document.createElement('button');
                    cell.className = "calendar-day";
                    if (lectionaryData[dateString]) {
                        cell.classList.add("has-data");
                    }
                    if (date.getDay() === 0) {
                        cell.classList.add("is-sunday");
                    }
                    cell.dataset.date = dateString;
                    cell.innerHTML = `<span class="day-number">${day}</span>`;
                    grid.appendChild(cell);
                }
                lectionaryDayGridContainer.appendChild(grid);
            }

            function showLectionaryPopup(dateString) {
                const data = lectionaryData[dateString] || placeholderData;
                displayPopupContent(dateString, data);
            }
            
            function displayPopupContent(dateString, data) {
                const [year, month, day] = dateString.split('-').map(Number);
                const date = new Date(year, month - 1, day);
                const dayOfWeek = date.getDay();
                lectionaryPopupTitle.textContent = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                const buildOfficeHtml = (title, readings, collect) => {
                    let collectsHtml = '';
                    if (title === "Oración Matutina") {
                        const dayCollect = dailyCollects.morning[dayOfWeek];
                        collectsHtml = `<h5 class="font-bold">Las Colectas</h5>
                                        <p class="liturgy-text"><strong>La Colecta del Día:</strong><br>${collect}</p>
                                        <p class="liturgy-text"><strong>${dayCollect.title}:</strong><br>${dayCollect.text}</p>`;
                        return `
                            <div class="office-section mb-8">
                                <h4 class="text-xl font-bold text-teal-700 border-b pb-2 mb-3">${title}</h4>
                                <h5 class="font-bold">Sentencia de Apertura</h5>
                                <p class="liturgy-text">Que Dios nuestro Padre y el Señor Jesucristo les concedan gracia y paz. <em>(Filipenses 1:2)</em></p>
                                <h5 class="font-bold">Confesión del Pecado</h5>
                                <p class="liturgy-text"><strong>Padre todopoderoso y misericordioso, nos hemos equivocado y desviado de tus caminos como ovejas extraviadas. Hemos seguido demasiado los engaños y deseos de nuestro propio corazón. Hemos ofendido contra tus santas leyes. Hemos dejado de hacer lo que debíamos haber hecho; y hemos hecho lo que no debíamos hacer; y sin tu gracia, no hay salud en nosotros. Señor, ten piedad de nosotros. Perdona a todos los que confiesan sus faltas. Conforme a tus promesas declaradas, restaura a todos los que se arrepienten, en Cristo Jesús nuestro Señor. Y concede, oh Padre misericordioso, por Él, que ahora podamos vivir una vida piadosa, justa y sobria, para la gloria de tu Santo Nombre. Amén.</strong></p>
                                <p class="liturgy-text"><em>El Sacerdote (o Obispo) se pone de pie y dice la Absolución:</em></p>
                                <p class="liturgy-text">Dios Todopoderoso, Padre de nuestro Señor Jesucristo, que no desea la muerte de los pecadores, sino que se aparten de su maldad y vivan. Él ha dado poder y ha ordenado a sus ministros que pronuncien a su pueblo arrepentido, la absolución y remisión de sus pecados. Él perdona y absuelve a todos los que verdaderamente se arrepienten y creen genuinamente en su santo Evangelio. Por esta razón, le rogamos que nos conceda el verdadero arrepentimiento y su Espíritu Santo, para que nuestros hechos presentes le agraden, el resto de nuestra vida sea pura y santa, y que al final lleguemos a su gozo eterno; por Jesucristo nuestro Señor. <strong>Amén.</strong></p>
                                <h5 class="font-bold">El Invitatorio</h5>
                                <p class="liturgy-text"><em>Todos se ponen de pie.</em></p>
                                <p class="liturgy-text">Oficiante: Señor, abre nuestros labios;<br><strong>Pueblo: Y nuestra boca proclamará tu alabanza.</strong></p>
                                <p class="liturgy-text">Oficiante: Oh Dios, apresúrate a salvarnos;<br><strong>Pueblo: Señor, date prisa en socorrernos.</strong></p>
                                <p class="liturgy-text">Oficiante: Gloria al Padre, al Hijo y al Espíritu Santo;<br><strong>Pueblo: Como era al principio, ahora y siempre, por los siglos de los siglos. Amén.</strong></p>
                                <p class="liturgy-text">Oficiante: Alabemos al Señor.<br><strong>Pueblo: Sea alabado el Nombre del Señor.</strong></p>
                                <h5 class="font-bold">Venite (Oh Vengan Exaltemos)</h5>
                                <p class="liturgy-text"><strong>Vengan, cantemos con júbilo al Señor; *<br>aclamemos a la roca de nuestra salvación.<br>Lleguemos ante él con acción de gracias, *<br>aclamémoslo con cánticos.<br>Porque el Señor es el gran Dios, *<br>el gran Rey sobre todos los dioses.<br>En sus manos están los abismos de la tierra; *<br>suyas son las cumbres de los montes.<br>Suyo es el mar, porque él lo hizo; *<br>con sus manos formó la tierra firme.<br>Vengan, postrémonos reverentes, *<br>doblemos la rodilla ante el Señor nuestro Hacedor.<br>Porque él es nuestro Dios *<br>y nosotros somos el pueblo de su prado;<br>¡Somos un rebaño bajo su cuidado!</strong></p>
                                <h5 class="font-bold">Salmos del Día: ${readings.psalms.ref}</h5>
                                <p class="liturgy-text">${readings.psalms.text}</p>
                                <h5 class="font-bold">Las Lecciones</h5>
                                <p class="liturgy-text"><strong>Antiguo Testamento: ${readings.ot.ref}</strong><br>${readings.ot.text}</p>
                                <p class="liturgy-text"><strong>Nuevo Testamento: ${readings.nt.ref}</strong><br>${readings.nt.text}</p>
                                <h5 class="font-bold">El Credo de los Apóstoles</h5>
                                <p class="liturgy-text"><strong>Creo en Dios Padre Todopoderoso, Creador del cielo y de la tierra. Creo en Jesucristo, su único Hijo, Nuestro Señor, que fue concebido por obra y gracia del Espíritu Santo, nació de Santa María Virgen, padeció bajo el poder de Poncio Pilato, fue crucificado, muerto y sepultado, descendió a los infiernos, al tercer día resucitó de entre los muertos, subió a los cielos, y está sentado a la derecha de Dios Padre. Desde allí ha de venir a juzgar a vivos y muertos. Creo en el Espíritu Santo, la Santa Iglesia Católica, la comunión de los santos, el perdón de los pecados, la resurrección de los muertos, y la vida eterna. Amén.</strong></p>
                                <h5 class="font-bold">Las Oraciones</h5>
                                <p class="liturgy-text"><strong>Padre nuestro que estás en el cielo, santificado sea tu Nombre, venga tu reino, hágase tu voluntad, en la tierra como en el cielo. Danos hoy nuestro pan de cada día. Perdona nuestras ofensas, como también nosotros perdonamos a los que nos ofenden. No nos dejes caer en tentación y líbranos del mal. Porque tuyo es el reino, tuyo es el poder, y tuya es la gloria, ahora y por siempre. Amén.</strong></p>
                                ${collectsHtml}
                                <h5 class="font-bold">Clausura del Oficio</h5>
                                <p class="liturgy-text">Que la gracia del Señor Jesucristo... Amén.</p>
                            </div>`;
                    }
                    if (title === "Oración del Mediodía") {
                        return `
                            <div class="office-section mb-8">
                                <h4 class="text-xl font-bold text-teal-700 border-b pb-2 mb-3">${title}</h4>
                                <p class="liturgy-text">Oficiante: Dios mío, ven en mi auxilio;<br><strong>Pueblo: Señor, date prisa en socorrernos.</strong></p>
                                <p class="liturgy-text"><strong>Gloria al Padre, al Hijo y al Espíritu Santo; como era al principio, ahora y siempre por los siglos de los siglos. Amén.</strong></p>
                                <h5 class="font-bold">Salmo 121</h5>
                                <p class="liturgy-text">A las montañas levanto mis ojos; ¿de dónde ha de venir mi ayuda? Mi ayuda proviene del Señor, creador del cielo y de la tierra...</p>
                                <h5 class="font-bold">Lectura de la Escritura</h5>
                                <p class="liturgy-text">Jesús dijo: "El juicio de este mundo ha llegado ya, y el príncipe de este mundo va a ser expulsado. Pero yo, cuando sea levantado de la tierra, atraeré a todos a mí mismo". <em>(Juan 12:31-32)</em></p>
                                <h5 class="font-bold">Las Oraciones</h5>
                                <p class="liturgy-text"><strong>Padre nuestro que estás en el cielo, santificado sea tu Nombre, venga tu reino, hágase tu voluntad, en la tierra como en el cielo. Danos hoy nuestro pan de cada día. Perdona nuestras ofensas, como también nosotros perdonamos a los que nos ofenden. No nos dejes caer en tentación y líbranos del mal. Porque tuyo es el reino, tuyo es el poder, y tuya es la gloria, ahora y por siempre. Amén.</strong></p>
                                <p class="liturgy-text">Bendito Salvador, en esta hora fuiste colgado de la Cruz, extendiendo tus brazos amorosos: Concede que todos los pueblos de la tierra te miren y se salven; por tu tierna misericordia. <strong>Amén.</strong></p>
                                <h5 class="font-bold">Clausura del Oficio</h5>
                                <p class="liturgy-text">Oficiante: Bendigamos al Señor.<br><strong>Pueblo: Gracias a Dios.</strong></p>
                            </div>`;
                    }
                    if (title === "Oración Vespertina") {
                        const dayCollect = dailyCollects.evening[dayOfWeek];
                        collectsHtml = `<h5 class="font-bold">Las Colectas</h5>
                                        <p class="liturgy-text"><strong>La Colecta del Día:</strong><br>${collect}</p>
                                        <p class="liturgy-text"><strong>${dayCollect.title}:</strong><br>${dayCollect.text}</p>`;
                        return `
                            <div class="office-section mb-8">
                                <h4 class="text-xl font-bold text-teal-700 border-b pb-2 mb-3">${title}</h4>
                                <h5 class="font-bold">Sentencia de Apertura</h5>
                                <p class="liturgy-text">"Yo soy la luz del mundo. El que me sigue no andará en tinieblas, sino que tendrá la luz de la vida". <em>(Juan 8:12)</em></p>
                                <h5 class="font-bold">Confesión del Pecado</h5>
                                <p class="liturgy-text"><strong>Padre todopoderoso y misericordioso, nos hemos equivocado y desviado de tus caminos como ovejas extraviadas. Hemos seguido demasiado los engaños y deseos de nuestro propio corazón. Hemos ofendido contra tus santas leyes. Hemos dejado de hacer lo que debíamos haber hecho; y hemos hecho lo que no debíamos hacer; y sin tu gracia, no hay salud en nosotros. Señor, ten piedad de nosotros. Perdona a todos los que confiesan sus faltas. Conforme a tus promesas declaradas, restaura a todos los que se arrepienten, en Cristo Jesús nuestro Señor. Y concede, oh Padre misericordioso, por Él, que ahora podamos vivir una vida piadosa, justa y sobria, para la gloria de tu Santo Nombre. Amén.</strong></p>
                                <p class="liturgy-text"><em>El Sacerdote (o Obispo) se pone de pie y dice la Absolución:</em></p>
                                <p class="liturgy-text">Dios Todopoderoso, Padre de nuestro Señor Jesucristo, que no desea la muerte de los pecadores, sino que se aparten de su maldad y vivan. Él ha dado poder y ha ordenado a sus ministros que pronuncien a su pueblo arrepentido, la absolución y remisión de sus pecados. Él perdona y absuelve a todos los que verdaderamente se arrepienten y creen genuinamente en su santo Evangelio. Por esta razón, le rogamos que nos conceda el verdadero arrepentimiento y su Espíritu Santo, para que nuestros hechos presentes le agraden, el resto de nuestra vida sea pura y santa, y que al final lleguemos a su gozo eterno; por Jesucristo nuestro Señor. <strong>Amén.</strong></p>
                                <h5 class="font-bold">El Invitatorio</h5>
                                <p class="liturgy-text">Oficiante: Señor, abre nuestros labios;<br><strong>Pueblo: Y nuestra boca proclamará tu alabanza.</strong></p>
                                <h5 class="font-bold">Phos Hilaron (Oh Luz Alegrante)</h5>
                                <p class="liturgy-text"><strong>Luz alegrante, claridad pura del siempre eterno Padre celestial, Jesucristo, Santo y bendito: Ahora que hemos llegado al ocaso del sol, y nuestros ojos miran la luz vespertina, te alabamos con himnos, oh Dios: Padre, Hijo y Espíritu Santo. Digno eres de ser alabado en todos los tiempos con voces gozosas, oh Hijo de Dios, dador de la vida; por tanto, te glorifica el universo entero.</strong></p>
                                <h5 class="font-bold">Salmos del Día: ${readings.psalms.ref}</h5>
                                <p class="liturgy-text">${readings.psalms.text}</p>
                                <h5 class="font-bold">Las Lecciones</h5>
                                <p class="liturgy-text"><strong>Antiguo Testamento: ${readings.ot.ref}</strong><br>${readings.ot.text}</p>
                                <p class="liturgy-text"><strong>Nuevo Testamento: ${readings.nt.ref}</strong><br>${readings.nt.text}</p>
                                <h5 class="font-bold">El Credo de los Apóstoles</h5>
                                <p class="liturgy-text"><strong>Creo en Dios Padre Todopoderoso, Creador del cielo y de la tierra. Creo en Jesucristo, su único Hijo, Nuestro Señor, que fue concebido por obra y gracia del Espíritu Santo, nació de Santa María Virgen, padeció bajo el poder de Poncio Pilato, fue crucificado, muerto y sepultado, descendió a los infiernos, al tercer día resucitó de entre los muertos, subió a los cielos, y está sentado a la derecha de Dios Padre. Desde allí ha de venir a juzgar a vivos y muertos. Creo en el Espíritu Santo, la Santa Iglesia Católica, la comunión de los santos, el perdón de los pecados, la resurrección de los muertos, y la vida eterna. Amén.</strong></p>
                                <h5 class="font-bold">Las Oraciones</h5>
                                <p class="liturgy-text"><strong>Padre nuestro que estás en el cielo, santificado sea tu Nombre, venga tu reino, hágase tu voluntad, en la tierra como en el cielo. Danos hoy nuestro pan de cada día. Perdona nuestras ofensas, como también nosotros perdonamos a los que nos ofenden. No nos dejes caer en tentación y líbranos del mal. Porque tuyo es el reino, tuyo es el poder, y tuya es la gloria, ahora y por siempre. Amén.</strong></p>
                                ${collectsHtml}
                                <h5 class="font-bold">Clausura del Oficio</h5>
                                <p class="liturgy-text">Que la gracia del Señor Jesucristo... Amén.</p>
                            </div>`;
                    }
                };

                const morningPrayerHtml = buildOfficeHtml("Oración Matutina", data.morning, data.collect);
                const middayPrayerHtml = buildOfficeHtml("Oración del Mediodía", {}, data.collect);
                const eveningPrayerHtml = buildOfficeHtml("Oración Vespertina", data.evening, data.collect);

                lectionaryPopupBody.innerHTML = morningPrayerHtml + '<hr class="my-8 border-gray-300">' + middayPrayerHtml + '<hr class="my-8 border-gray-300">' + eveningPrayerHtml;

                lectionaryPopupOverlay.classList.remove('hidden');
                lectionaryPopup.classList.remove('hidden');
                setTimeout(() => {
                    lectionaryPopupOverlay.classList.add('opacity-100');
                    lectionaryPopup.classList.add('scale-100');
                }, 10);
                document.body.style.overflow = 'hidden';
            }

            function closeLectionaryPopup() {
                lectionaryPopupOverlay.classList.remove('opacity-100');
                lectionaryPopup.classList.remove('scale-100');
                setTimeout(() => {
                    lectionaryPopupOverlay.classList.add('hidden');
                    lectionaryPopup.classList.add('hidden');
                    document.body.style.overflow = '';
                }, 300);
            }

            // --- EVENT LISTENERS ---
            Object.keys(mainNavButtons).forEach(key => {
                if(mainNavButtons[key]) {
                    mainNavButtons[key].addEventListener('click', () => switchView(key));
                }
            });

            backToCalendarBtn.addEventListener('click', hideFullLiturgy);
            printBtn.addEventListener('click', () => window.print());
            
            downloadDocxBtn.addEventListener('click', () => {
                const title = fullLiturgyUI.title.textContent;
                const subtitle = fullLiturgyUI.subtitle.textContent;
                const contentElement = document.getElementById('full-liturgy-content').cloneNode(true);

                contentElement.querySelectorAll('.ref-link').forEach(el => {
                    const sup = document.createElement('sup');
                    sup.textContent = el.textContent;
                    el.parentNode.replaceChild(sup, el);
                });

                const liturgyBody = contentElement.querySelector('.bg-white');
                if (!liturgyBody) {
                    console.error("Liturgy content body not found for DOCX export.");
                    return;
                }
                
                const headerHtml = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h1>${title}</h1>
                        <p><em>${subtitle}</em></p>
                    </div>
                `;

                const styles = `
                    <style>
                        body { font-family: 'Times New Roman', Times, serif; font-size: 10pt; }
                        h1 { font-size: 16pt; font-weight: bold; }
                        p { font-size: 12pt; }
                        h2 { font-size: 14pt; font-weight: bold; border-bottom: 1px solid #000; padding-bottom: 5px; margin-top: 20px; }
                        h3 { font-size: 11pt; font-weight: bold; margin-top: 15px; }
                        .liturgy-text { margin-top: 10px; }
                        strong { font-weight: bold; }
                        em, i { font-style: italic; }
                    </style>
                `;

                const twoColumnContent = `<div style="column-count: 2; column-gap: 40px;">${liturgyBody.innerHTML}</div>`;

                const fullHtmlForDocx = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        ${styles}
                    </head>
                    <body>
                        ${headerHtml}
                        ${twoColumnContent}
                    </body>
                    </html>
                `;

                try {
                    const converted = htmlDocx.asBlob(fullHtmlForDocx, {
                        orientation: 'landscape',
                        margins: { top: 720, right: 720, bottom: 720, left: 720 }
                    });
                    saveAs(converted, `${title}.docx`);
                } catch (error) {
                    console.error("Error generating DOCX file:", error);
                }
            });
            
            cardsContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.liturgical-card');
                if (card && card.dataset.date) {
                    const [year, month, day] = card.dataset.date.split('-').map(Number);
                    const selectedDate = new Date(year, month - 1, day);
                    showFullLiturgy(selectedDate);
                }
            });

            // --- THEOLOGY POPUP LISTENERS ---
            fullLiturgyView.addEventListener('click', showTheologyPopup);
            theologyPopupClose.addEventListener('click', closeTheologyPopup);
            theologyPopupOverlay.addEventListener('click', closeTheologyPopup);

            // --- LECTIONARY POPUP LISTENERS ---
            lectionaryDayGridContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.calendar-day');
                if (card && card.dataset.date) {
                    showLectionaryPopup(card.dataset.date);
                }
            });
            lectionaryPopupClose.addEventListener('click', closeLectionaryPopup);
            lectionaryPopupOverlay.addEventListener('click', closeLectionaryPopup);


            // --- LOGO UPLOAD LISTENERS ---
            uploadLogoBtn.addEventListener('click', () => logoUploader.click());

            logoUploader.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const logoDataUrl = e.target.result;
                        localStorage.setItem('userLogo', logoDataUrl);
                        logoImage.src = logoDataUrl;
                    }
                    reader.readAsDataURL(file);
                }
            });

            // --- HEADER SCROLL LOGIC ---
            let lastScrollTop = 0;
            const mainHeader = document.getElementById('main-header');
            window.addEventListener("scroll", function() {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if (scrollTop > lastScrollTop && scrollTop > mainHeader.offsetHeight) {
                    mainHeader.classList.add('header-hidden');
                } else {
                    mainHeader.classList.remove('header-hidden');
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }, false);

            // --- MOBILE MENU LOGIC ---
            function openMobileMenu() {
                mobileMenu.classList.remove('menu-hidden');
                document.body.style.overflow = 'hidden';
            }

            function closeMobileMenu() {
                mobileMenu.classList.add('menu-hidden');
                document.body.style.overflow = '';
            }

            hamburgerBtn.addEventListener('click', openMobileMenu);
            closeMenuBtn.addEventListener('click', closeMobileMenu);
            mobileNavLinks.addEventListener('click', (e) => {
                if (e.target.matches('a.mobile-nav-link')) {
                    const view = e.target.dataset.view;
                    if (view) {
                        switchView(view);
                    }
                    closeMobileMenu();
                }
            });

            // --- INITIALIZATION ---
            function initializeApp() {
                setTimeout(() => {
                    splashScreen.classList.add('fade-out');
                    mainContent.classList.remove('opacity-0');
                    setTimeout(() => {
                        splashScreen.style.display = 'none';
                    }, 1500);
                }, 2000);

                loadLogoFromStorage();
                switchView('home');
                renderLiturgicalCards();
                renderLectionaryInterface();
            }
            initializeApp();
        });
    </script>
</body>
</html>
