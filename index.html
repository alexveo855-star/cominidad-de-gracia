<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBCG APP - Liturgia 2025 (Ciclo C)</title>
    <!-- Favicon para Navegadores y Accesos Directos en Móviles -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🕊️%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🕊️%3C/text%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
<style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Roboto:wght@400;500;700&display=swap');
        body {
            font-family: 'Merriweather', serif;
            background-image: url('https://www.bibleserver.com/build/bs-start-back-Dno9hVpC.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #433A3F; 
        }
        h1, h2, h3, h4, h5, h6, .nav-item, .filter-button, .main-nav-button {
            font-family: 'Roboto', sans-serif;
        }
        .liturgy-text {
            transition: all 0.3s ease-in-out;
            border-left: 4px solid transparent;
            padding-left: 1rem;
            margin-top: 1rem;
            line-height: 1.7; /* Slightly adjusted line height */
            font-size: 0.9rem; /* Base font size for mobile */
        }
        @media (min-width: 768px) {
            .liturgy-text {
                font-size: 1rem; /* Larger font size for desktop */
            }
        }
        #main-header {
            transition: transform 0.3s ease-in-out;
        }
        .header-hidden {
            transform: translateY(-100%);
        }
        .ref-link {
            cursor: pointer;
            font-weight: bold;
            /* The text color of the word itself is inherited */
            text-decoration: none;
            position: relative;
        }
        .ref-link sup {
            font-size: 0.7em;
            vertical-align: super;
            margin-left: 1px;
            font-weight: 900;
            color: #dc2626; /* red-600 */
        }
        
        /* --- Mobile-Optimized Popup/Modal Styles --- */
        #theology-popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            z-index: 100;
        }
        #theology-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center the popup */
            width: 90%;
            max-width: 450px; /* Slightly wider for more content */
            max-height: 80vh; /* Prevent it from being too tall */
            overflow-y: auto; /* Allow scrolling within the popup */
            background-color: white;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            z-index: 110;
            font-family: 'Merriweather', serif;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #334155;
        }
        #theology-popup h5 {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            color: #0d9488;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        #theology-popup .original-term {
            font-size: 1.5rem;
            font-family: 'Times New Roman', serif;
        }
        #popup-close {
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #94a3b8;
            cursor: pointer;
            line-height: 1;
        }
        #popup-close:hover { color: #475569; }
        
        /* Full Screen Liturgy View Styles */
        #full-liturgy-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #FDFBF5; z-index: 100; overflow-y: auto;
        }
        .liturgy-section h2 {
            font-size: 1.25rem; /* Reduced for mobile */
            font-weight: 700; border-bottom: 2px solid #fBBF24; padding-bottom: 0.5rem; margin-bottom: 1.5rem; margin-top: 2.5rem; color: #1e293b;
        }
        .liturgy-section h3 {
            font-size: 1rem; /* Reduced for mobile */
            font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.5rem; color: #334155;
        }
        @media (min-width: 768px) {
            .liturgy-section h2 { font-size: 1.5rem; }
            .liturgy-section h3 { font-size: 1.1rem; }
        }
        
        /* --- NEW BIBLE VIEW STYLES --- */
        .bible-nav-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .bible-nav-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .bible-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }
        .bible-book-card, .bible-chapter-card {
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
        /* Style for verse numbers */
        #chapter-content-view > p > sup:first-child { 
            font-size: 0.65em; vertical-align: super; color: #0f766e; font-weight: bold; margin-right: 0.2em; line-height: 1; 
        }
        .verse-wrapper {
            margin-bottom: 0.25rem;
            padding: 0.1rem 0;
            transition: background-color 0.2s;
            line-height: 1.9;
        }
        .has-commentary {
            background-color: #f0fdfa; /* teal-50 */
            border-left: 4px solid #14b8a6; /* teal-500 */
            padding: 0.5rem 1rem;
            margin: 0.5rem -1rem;
            border-radius: 8px;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1489664942048-a3a60914a2f4?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center;
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center;
            transition: opacity 1.5s ease-in-out;
            padding: 1rem;
        }
        #splash-screen.fade-out {
            opacity: 0;
        }
        .splash-title {
            font-family: 'Merriweather', serif;
            font-size: 2.5rem; sm:font-size: 3rem; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .splash-subtitle {
            font-family: 'Roboto', sans-serif;
            font-size: 1.1rem; sm:font-size: 1.25rem; margin-top: 0.5rem; text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        /* Main Menu */
        .main-nav-button {
            padding: 0.5rem 0;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #4b5563; /* gray-600 */
            transition: all 0.2s ease-in-out;
            font-size: 0.875rem; sm:font-size: 1rem;
        }
        .main-nav-button:hover {
            color: #0d9488; /* teal-600 */
            border-bottom-color: #99f6e4; /* teal-200 */
        }
        .active-nav {
            color: #0f766e; /* teal-700 */
            font-weight: 700;
            border-bottom-color: #0f766e; /* teal-700 */
        }
        
        /* Liturgical Cards Styles */
        .liturgical-card {
            background-color: white;
            border-left-width: 6px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .liturgical-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        /* Mobile Menu Transition */
        .menu-hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Print Styles */
        .print-only-header { display: none; }
        @media print {
            @page {
                size: letter landscape;
                margin: 1cm;
            }
            body, html { background-color: white !important; }
            body > *:not(#full-liturgy-view) { display: none; }
            #full-liturgy-view {
                position: static; width: auto; height: auto; overflow: visible; background-color: white !important;
            }
            #full-liturgy-header { display: none; }
            .print-only-header { display: block; text-align: center; margin-bottom: 1cm; break-after: avoid; }
            .print-title { font-size: 16pt; font-weight: bold; font-family: 'Times New Roman', Times, serif; }
            .print-subtitle { font-size: 12pt; font-style: italic; font-family: 'Times New Roman', Times, serif; }
            #full-liturgy-content { padding: 0; margin: 0; }
            .print-liturgy-body { column-count: 2; column-gap: 1.5cm; }
            .liturgy-section { break-inside: avoid; }
            .liturgy-section h2 { font-size: 14pt !important; color: black !important; border-bottom: 2px solid black; break-after: avoid; padding-top: 1em; }
            .liturgy-section:first-of-type h2 { padding-top: 0; }
            .liturgy-section h3 { font-size: 11pt !important; color: black !important; }
            body, .liturgy-text, p { font-family: 'Times New Roman', Times, serif; font-size: 10pt !important; color: black !important; background-color: white !important; }
            .ref-link { display: none; }
            #full-liturgy-content .bg-white { box-shadow: none; padding: 0; }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="menu-hidden fixed inset-0 bg-white z-50 flex flex-col items-center justify-center transition-opacity duration-300 ease-in-out">
        <button id="close-menu-btn" class="absolute top-5 right-5 text-gray-600 hover:text-gray-900 p-2">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        <nav id="mobile-nav-links" class="flex flex-col items-center gap-8">
            <a data-view="home" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Inicio</a>
            <a data-view="liturgy" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Liturgia</a>
            <a data-view="bible" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Biblia</a>
            <a data-view="glossary" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Recursos</a>
            <a data-view="lectionary" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Leccionario</a>
            <a href="https://www.bibleserver.com/nicodemus-ai" target="_blank" rel="noopener noreferrer" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600">Nicodemus IA</a>
        </nav>
    </div>

    <div id="splash-screen">
        <h1 class="splash-title">Comunidad de Gracia</h1>
        <p class="splash-subtitle">Liturgia y Recursos</p>
    </div>

    <div id="main-content" class="opacity-0 transition-opacity duration-500">
        <header id="main-header" class="bg-white/80 backdrop-blur-sm shadow-sm py-2 px-4 sticky top-0 z-20">
            <div class="container mx-auto flex justify-between items-center">
                <!-- Logo and Title -->
                <div class="flex items-center gap-3">
                    <img id="logo-image" src="https://scontent-mia3-1.xx.fbcdn.net/v/t39.30808-1/458442022_122107426106496454_2577487987417874050_n.jpg?stp=dst-jpg_s200x200_tt6&_nc_cat=111&ccb=1-7&_nc_sid=2d3e12&_nc_ohc=Zy1TV0kujjIQ7kNvwEz8bgt&_nc_oc=Adl4Yh0O1zq-mS8LlfMHzCmTKgBM-yzBhJyyNVnQtxBS9eQMVoKdbqWamxJjkk23f78&_nc_zt=24&_nc_ht=scontent-mia3-1.xx&_nc_gid=AuKzGmho4nnugwzcXEAx7A&oh=00_AfQLVtVuH2tLlf7fZE-otz8oogECgeQlPogoM7mnCAewGA&oe=68938DFE" onerror="this.onerror=null;this.src='https://placehold.co/100x100/3A5F7D/FFFFFF?text=Logo';" alt="Logo Comunidad de Gracia" class="h-10 w-auto rounded-full">
                    <h1 class="text-lg sm:text-xl font-bold text-gray-800">IBCG APP</h1>
                </div>
                <!-- Desktop Navigation Buttons -->
                <nav class="hidden lg:flex flex-wrap justify-center items-center gap-x-3 sm:gap-x-4 md:gap-x-6">
                    <a id="btn-home" class="main-nav-button cursor-pointer">Inicio</a>
                    <a id="btn-liturgy" class="main-nav-button cursor-pointer">Liturgia</a>
                    <a id="btn-bible" class="main-nav-button cursor-pointer">Biblia</a>
                    <a id="btn-glossary" class="main-nav-button cursor-pointer">Recursos</a>
                    <a id="btn-lectionary" class="main-nav-button cursor-pointer">Leccionario</a>
                    <a href="https://www.bibleserver.com/nicodemus-ai" target="_blank" rel="noopener noreferrer" class="main-nav-button">Nicodemus IA</a>
                    <a id="btn-upload-logo" class="main-nav-button cursor-pointer">
                        <svg class="w-6 h-6 text-gray-600 hover:text-teal-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </a>
                </nav>
                <!-- Mobile Menu Button -->
                <div class="lg:hidden flex items-center">
                    <button id="hamburger-btn" class="p-2 rounded-md text-gray-600 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-teal-500">
                        <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <input type="file" id="logo-uploader" class="hidden" accept="image/*">

        <div id="home-view" class="min-h-[85vh]">
            <!-- This div is intentionally empty to show the body background -->
        </div>

        <div id="liturgy-view" class="hidden">
            <main class="container mx-auto p-4">
                <div class="bg-white/80 backdrop-blur-sm p-4 sm:p-6 rounded-lg shadow-2xl">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center border-b-2 border-amber-400 pb-3">Calendario Litúrgico 2025</h2>
                    <div id="liturgical-cards-container" class="space-y-4">
                        <!-- Liturgical cards will be inserted here by JavaScript -->
                    </div>
                </div>
            </main>
        </div>

        <div id="bible-view" class="hidden">
            <main class="container mx-auto p-4">
                <div id="bible-header" class="bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-md mb-6">
                     <div class="flex items-center">
                        <button id="bible-back-btn" class="hidden mr-4 text-gray-600 hover:text-gray-900 p-2 rounded-full hover:bg-gray-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <h2 id="bible-view-title" class="text-xl sm:text-2xl font-bold text-gray-800">Biblia</h2>
                     </div>
                </div>
        
                <div id="bible-navigation-content">
                    <!-- 1. Testament Selection -->
                    <div id="testament-selector-view" class="fade-in">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div id="select-ot" class="bible-nav-card cursor-pointer bg-white/80 backdrop-blur-sm p-8 rounded-lg shadow-lg text-center">
                                <h3 class="text-2xl font-bold text-teal-800">Antiguo Testamento</h3>
                            </div>
                            <div id="select-nt" class="bible-nav-card cursor-pointer bg-white/80 backdrop-blur-sm p-8 rounded-lg shadow-lg text-center">
                                <h3 class="text-2xl font-bold text-teal-800">Nuevo Testamento</h3>
                            </div>
                        </div>
                    </div>
        
                    <!-- 2. Book Selection -->
                    <div id="book-selector-view" class="hidden fade-in bible-grid">
                        <!-- Book cards will be injected here -->
                    </div>
        
                    <!-- 3. Chapter Selection -->
                    <div id="chapter-selector-view" class="hidden fade-in bible-grid">
                         <!-- Chapter cards will be injected here -->
                    </div>
        
                    <!-- 4. Chapter Content -->
                    <div id="chapter-content-view" class="hidden fade-in bg-white/80 backdrop-blur-sm p-6 rounded-lg shadow-inner max-w-none">
                         <!-- Chapter text will be injected here -->
                    </div>
                </div>
            </main>
        </div>

        <div id="glossary-view" class="hidden">
            <main class="container mx-auto p-4 md:p-8">
                <div class="bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl sm:text-3xl font-bold border-b-2 border-amber-400 pb-2 mb-6 text-gray-800">ACNA: Libro de Oración Común y Recursos</h2>
                    <div class="mt-8 text-center bg-stone-100 p-6 sm:p-8 rounded-lg shadow">
                        <p class="text-lg text-gray-700 mb-4">Para acceder a los recursos del Libro de Oración Común, por favor haz clic en el siguiente botón. El sitio se abrirá en una nueva pestaña del navegador.</p>
                        <a href="https://bcp2019.anglicanchurch.net/index.php/downloads-espanol/" target="_blank" rel="noopener noreferrer" class="inline-block bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors shadow-md">
                            Ir a Recursos ACNA
                        </a>
                    </div>
                </div>
            </main>
        </div>

        <div id="lectionary-view" class="hidden">
            <main class="container mx-auto p-4 md:p-8 flex items-center justify-center min-h-[85vh]">
                <div class="w-full max-w-2xl bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl sm:text-3xl font-bold border-b-2 border-amber-400 pb-2 mb-6 text-gray-800">Leccionario Diario 2025</h2>
                    <div class="mt-8 text-center bg-stone-100 p-6 sm:p-8 rounded-lg shadow">
                        <p class="text-lg text-gray-700 mb-6">El Leccionario Diario se abrirá en una nueva pestaña del navegador para una mejor experiencia de visualización.</p>
                        <a href="https://liturgical-calendar.com/es/ACNA2019/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-3 bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors shadow-md">
                            <span>Abrir Leccionario</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        </a>
                    </div>
                </div>
            </main>
        </div>
        
        <footer class="bg-gray-800/90 text-white py-6 px-4">
            <div class="container mx-auto text-center">
                <div class="flex justify-center space-x-6 mb-4">
                    <!-- Facebook Icon -->
                    <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="Facebook">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878C18.343 21.128 22 16.991 22 12z" />
                        </svg>
                    </a>
                    <!-- Instagram Icon -->
                    <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="Instagram">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 016.08 2.525c.636-.247 1.363-.416 2.427-.465C9.53 2.013 9.884 2 12.315 2zM12 0C9.81 0 9.448.01 8.378.058c-1.11.05-1.897.227-2.613.51a6.888 6.888 0 00-2.15 1.417A6.888 6.888 0 002.2 4.135c-.283.716-.46 1.503-.51 2.613C1.632 7.795 1.62 8.157 1.62 10.647s.012 2.852.058 3.922c.05 1.11.227 1.897.51 2.613a6.888 6.888 0 001.417 2.15 6.888 6.888 0 002.15 1.417c.716.283 1.503.46 2.613.51 1.07.048 1.432.058 3.922.058s2.852-.01 3.922-.058c1.11-.05 1.897-.227 2.613-.51a6.888 6.888 0 002.15-1.417 6.888 6.888 0 001.417-2.15c.283-.716.46-1.503.51-2.613.048-1.07.058-1.432.058-3.922s-.01-2.852-.058-3.922c-.05-1.11-.227-1.897-.51-2.613a6.888 6.888 0 00-1.417-2.15A6.888 6.888 0 0018.865 2.2c-.716-.283-1.503-.46-2.613-.51C15.182.01 14.82 0 12.315 0z" clip-rule="evenodd" />
                            <path d="M16.95 6.402a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5zM12 8.26a3.74 3.74 0 100 7.48 3.74 3.74 0 000-7.48zM12 13.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z" />
                        </svg>
                    </a>
                    <!-- TikTok Icon -->
                    <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="TikTok">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-2.43.05-4.86-.95-6.69-2.79-1.75-1.75-2.81-4.15-2.8-6.6.01-2.33 1.01-4.6 2.66-6.21 1.72-1.68 4.06-2.63 6.4-2.66.12-2.17.1-4.34.01-6.51z" />
                        </svg>
                    </a>
                    <!-- X (Twitter) Icon -->
                    <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="X">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                        </svg>
                    </a>
                </div>
                <p>&copy; 2025 IBCG APP. Todos los derechos reservados.</p>
                <p class="text-sm text-gray-400 mt-2">Textos litúrgicos del Misal Romano. Textos bíblicos de la Conferencia Episcopal Española.</p>
            </div>
        </footer>
    </div>

    <div id="full-liturgy-view" class="hidden">
        <header id="full-liturgy-header" class="sticky top-0 bg-white/95 backdrop-blur-sm shadow-md z-10">
            <div class="container mx-auto flex items-center justify-between p-2 sm:p-4">
                <button id="back-to-calendar-btn" title="Volver al calendario" class="flex-shrink-0 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    <span class="hidden sm:inline font-semibold text-base">Volver</span>
                </button>
                <div class="flex-grow text-center min-w-0 px-2">
                    <h1 id="full-liturgy-title" class="text-sm sm:text-base md:text-lg font-bold text-gray-800 truncate"></h1>
                    <p id="full-liturgy-subtitle" class="text-xs text-gray-600 truncate"></p>
                </div>
                <div class="flex-shrink-0 flex items-center gap-2 sm:gap-4">
                    <button id="download-docx-btn" title="Descargar como DOCX" class="text-gray-600 hover:text-gray-900 transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    </button>
                    <button id="print-btn" title="Imprimir Liturgia" class="text-gray-600 hover:text-gray-900 transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                    </button>
                </div>
            </div>
        </header>
        <main id="full-liturgy-content" class="container mx-auto p-4 md:p-8">
            
</main>
    </div>

    <!-- Mobile-Optimized Popup -->
    <div id="theology-popup-overlay"></div>
    <div id="theology-popup">
        <span id="popup-close">&times;</span>
        <div id="popup-content-theology"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- HELPER FUNCTIONS ---
            const addDays = (d, days) => { const res = new Date(d); res.setDate(d.getDate() + days); return res; };
            const placeholderChapter = (numChapters) => Array.from({ length: numChapters }, (_, i) => [{ verse: 1, text: `[Texto del capítulo ${i + 1} no cargado para optimizar el rendimiento.]` }]);

            // --- THEOLOGICAL DATA & HELPERS (GLOBAL SCOPE) ---
            const terms = {
                // Terms for Liturgy
                hypostasis: {original: "ὑπόστασις", transliteration: "hypóstasis", meaning: "Sustancia, fundamento, garantía. En este contexto, la fe es la realidad fundamental de lo que se espera."},
                elenchos: {original: "ἔλεγχος", transliteration: "élenchos", meaning: "Prueba, convicción. La fe proporciona una certeza interior sobre realidades que no se ven."},
                epangelia: {original: "ἐπαγγελία", transliteration: "epangelía", meaning: "Promesa. Un compromiso divino que es el objeto de la esperanza y la fe del creyente."},
                poimnion: {original: "ποίμνιον", transliteration: "poímnion", meaning: "Rebaño pequeño. Término de cariño y ternura que Jesús usa para sus discípulos, destacando su vulnerabilidad y la protección de Dios."},
                kardia: {original: "καρδία", transliteration: "kardía", meaning: "Corazón. En la Biblia, no es solo el asiento de las emociones, sino el centro del intelecto, la voluntad y toda la persona."},
                gregoreō: {original: "γρηγορέω", transliteration: "grēgoreō", meaning: "Velar, estar despierto. Una actitud de alerta espiritual y preparación constante para la venida del Señor."},
                doulos: {original: "δοῦλος", transliteration: "doûlos", meaning: "Siervo, esclavo. Describe la total devoción y obediencia a un amo; en el Nuevo Testamento, se usa para la relación del creyente con Cristo."},
                // Terms for Genesis 1
                bara: { original: "בָּרָא", transliteration: "bārā'", meaning: "Verbo hebreo exclusivo para la acción creadora de Dios. Implica una creación desde la nada (ex nihilo), sin materia preexistente, y denota una acción soberana y sin esfuerzo.", commentary: "<strong>Catecismo de la Iglesia Católica (CIC 296):</strong> 'Creemos que Dios no necesita nada preexistente ni ninguna ayuda para crear. La creación tampoco es una emanación necesaria de la sustancia divina. Dios crea libremente “de la nada”'. Esta doctrina es fundamental para entender la total soberanía y trascendencia de Dios." },
                tohu: { original: "תֹהוּ וָבֹהוּ", transliteration: "tōhû wā-ḇōhû", meaning: "'Caos y vacío' o 'sin forma y vacía'. Describe un estado de desorden primordial, una materia sin estructura que la Palabra de Dios ordenará y llenará.", commentary: "<strong>San Agustín, Confesiones (Libro XII):</strong> Agustín interpreta esta 'materia informe' no como algo co-eterno con Dios, sino como la primera creación de Dios, la potencialidad pura que luego es formada y ordenada. No es un mal, sino la ausencia de bien (forma, orden)." },
                ruach: { original: "רוּחַ אֱלֹהִים", transliteration: "rûaḥ ’ĕlōhîm", meaning: "'Espíritu de Dios' o 'Viento de Dios'. La palabra 'ruach' puede significar aliento, viento o espíritu. Aquí representa la presencia dinámica y vivificante de Dios sobre la creación incipiente.", commentary: "<strong>Joseph Ratzinger (Benedicto XVI), 'En el principio creó Dios':</strong> 'El Espíritu Santo es el poder por el que Dios obra... La creación es obra de la Trinidad. El Padre es la fuente, el Hijo (la Palabra) da la forma, y el Espíritu Santo es el poder que la realiza y la llena de vida.'" },
                yom: { original: "יוֹם", transliteration: "yôm", meaning: "'Día'. Su interpretación es compleja. Puede referirse a un día literal de 24 horas, a una era o período de tiempo indefinido, o a un marco literario para estructurar la narrativa de la creación.", commentary: "<strong>CIC 337:</strong> 'Nada se opone a que la Sagrada Escritura describa la obra de la creación con la forma literaria de una sucesión de seis días.' La Iglesia no se pronuncia sobre la interpretación científica de la duración, pero afirma el orden y la bondad de todo lo creado por Dios, y que la creación culmina en el descanso del séptimo día." },
                tzelem: { original: "צֶלֶם אֱלֹהִים", transliteration: "ṣelem ’ĕlōhîm", meaning: "'Imagen de Dios'. El ser humano es creado a imagen y semejanza de Dios. Esto no se refiere a una semejanza física, sino a la capacidad de razón, libre albedrío, amor y comunión, que refleja la naturaleza de Dios.", commentary: "<strong>San Juan Pablo II, Teología del Cuerpo:</strong> 'Ser imagen de Dios significa que el hombre es un ser capaz de entrar en relación. La comunión de personas (Adán y Eva) refleja la comunión de Personas en la Trinidad. La dignidad humana reside en esta capacidad de amar y ser amado, de conocer y de elegir libremente el bien.'" },
                // Terms for Genesis 2
                shabbat: { original: "שָׁבַת", transliteration: "šāḇaṯ", meaning: "'Cesó', 'descansó'. Es la raíz del Sabbat. El descanso de Dios no es por cansancio, sino la culminación de su obra, entrando en la perfección y plenitud de lo creado.", commentary: "<strong>CIC 345, 2168:</strong> El séptimo día es la bendición y santificación del tiempo. Para el hombre, el Sabbat es una invitación a participar en el descanso de Dios, a cesar del trabajo servil y a dedicar tiempo a la adoración y a la comunión con Dios y la familia. Jesucristo es el Señor del Sabbat, y su Resurrección en el 'octavo día' inaugura el nuevo Sabbat cristiano: el Domingo, el Día del Señor." },
                adamah: { original: "אֲדָמָה", transliteration: "’ăḏāmāh", meaning: "'Suelo', 'tierra'. El hombre (אָדָם, 'ādām) es formado del suelo, destacando su conexión con la tierra y su humildad material.", commentary: "Esta conexión subraya tanto la fragilidad humana ('polvo eres y al polvo volverás', Génesis 3:19) como su dignidad. El hombre es el puente entre lo terrenal (su cuerpo) y lo divino (el aliento de vida de Dios). Es el custodio de la creación, no su dueño absoluto." },
                neshamah: { original: "נִשְׁמַת חַיִּים", transliteration: "nišmaṯ ḥayyîm", meaning: "'Aliento de vida'. Es el soplo divino que anima la materia y hace del hombre un ser viviente, un 'alma viviente' (nefesh hayyah).", commentary: "<strong>CIC 362:</strong> 'El relato bíblico expresa esta realidad con un lenguaje simbólico cuando afirma que “Dios formó al hombre con polvo del suelo e insufló en sus narices aliento de vida y resultó el hombre un ser viviente”. El alma humana es creada directamente por Dios; no es “producida” por los padres.'" },
                ganeden: { original: "גַּן־בְּעֵדֶן", transliteration: "gan-be‘Ēḏen", meaning: "'Jardín en Edén'. Edén significa 'delicia' o 'placer'. No es solo un lugar geográfico, sino un estado de armonía original con Dios, con la creación y dentro del propio ser humano.", commentary: "El Jardín de Edén simboliza el estado de 'justicia original' en el que el hombre fue creado: libre de la concupiscencia, en amistad íntima con Dios, y en perfecta armonía. La presencia de los dos árboles indica que la libertad humana, desde el principio, está intrínsecamente ligada a la ley moral y a la relación con el Creador." },
                ezerkenegdo: { original: "עֵזֶר כְּנֶגְדּוֹ", transliteration: "‘ēzer kənegdô", meaning: "'Ayuda idónea' o 'ayuda correspondiente a él'. 'Ezer' es ayuda (a menudo usada para Dios como ayudador de Israel) y 'kenegdo' significa 'frente a él', 'correspondiente a él'. No implica subordinación, sino una complementariedad esencial.", commentary: "<strong>San Juan Pablo II, Mulieris Dignitatem:</strong> 'La mujer es otro “yo” en la común humanidad. Desde el principio son “unidad de los dos”... Esto indica una relación de reciprocidad, donde ambos son un don el uno para el otro. La mujer ayuda al hombre a ser hombre, y el hombre ayuda a la mujer a ser mujer, encontrando ambos su plenitud en la comunión de personas.'" },
                // Terms for Genesis 9
                nefesh: { original: "נֶפֶשׁ חַיָּה", transliteration: "nefeš ḥayyāh", meaning: "'Ser viviente' o 'alma viviente'. Se refiere a la vida animada, tanto humana como animal. La sangre es considerada el asiento de esta vida.", commentary: "<strong>CIC 2260:</strong> 'El pacto de Dios con la humanidad está tejido con la consideración de la vida... La prohibición de derramar la sangre de un animal (Génesis 9:4) expresa que la vida es sagrada y pertenece a Dios. El mandamiento de no matar a un ser humano (Génesis 9:5-6) se basa en la dignidad suprema del hombre, creado a imagen de Dios.'" },
                berit: { original: "בְּרִית", transliteration: "berîṯ", meaning: "'Pacto' o 'Alianza'. Un acuerdo solemne y vinculante. En este contexto, no es un contrato entre iguales, sino un compromiso unilateral de Dios con toda la creación.", commentary: "<strong>Joseph Ratzinger (Benedicto XVI), 'En el principio creó Dios':</strong> 'El pacto noéico es universal. Precede a las alianzas particulares con Abraham e Israel y abarca a toda la humanidad y a la creación entera. Es la base de la paciencia de Dios con la historia humana, una promesa de que nunca más destruirá el mundo por agua, estableciendo un orden cósmico estable donde la vida puede florecer.'" },
                qeshet: { original: "קֶשֶׁת", transliteration: "qešeṯ", meaning: "'Arco'. La misma palabra hebrea para el arco de guerra. Dios cuelga su arma de guerra en las nubes como señal de paz y del fin de la hostilidad divina hacia la tierra.", commentary: "<strong>Nahum M. Sarna, 'Understanding Genesis':</strong> 'El simbolismo es profundo: el arma del guerrero divino se transforma en un signo de reconciliación. El arco, ahora apuntando lejos de la tierra, ya no es una amenaza, sino un recordatorio perpetuo de la promesa de gracia de Dios. Cada vez que aparece el arcoíris, es una manifestación visible del pacto divino.'" },
                // Terms for Genesis 10
                goyim: { original: "גּוֹיִם", transliteration: "gôyim", meaning: "'Naciones', 'pueblos'. Originalmente se refería a los pueblos no israelitas (gentiles), pero aquí se usa en un sentido universal para describir a toda la humanidad descendiente de Noé.", commentary: "<strong>CIC 56:</strong> 'La alianza con Noé después del diluvio expresa el principio de la economía divina con las «naciones». Esta alianza, válida mientras dura el tiempo de las naciones, testimonia que Dios quiere la unidad de toda la raza humana en su diversidad de pueblos, culturas y lenguas.'" },
                lashon: { original: "לָשׁוֹן", transliteration: "lāšôn", meaning: "'Lengua', 'idioma'. La diversidad de lenguas se presenta aquí como parte del orden natural de la dispersión de la humanidad, antes del juicio de Babel en el capítulo 11.", commentary: "Este capítulo presenta la diversidad como una bendición y un cumplimiento del mandato de 'llenar la tierra'. La teología posterior, especialmente después de Pentecostés (Hechos 2), verá la reunificación de las lenguas no en una uniformidad, sino en una comprensión mutua a través del Espíritu Santo, celebrando la unidad en la diversidad." },
                nimrod: { original: "נִמְרוֹד", transliteration: "Nimrôḏ", meaning: "El nombre significa 'nos rebelaremos'. Es una figura poderosa y ambigua, fundador de grandes imperios en Mesopotamia, incluyendo Babel. La tradición judía a menudo lo ve como un tirano que se rebeló contra Dios.", commentary: "<strong>San Agustín, 'La Ciudad de Dios' (Libro XVI):</strong> Agustín interpreta a Nimrod y la fundación de Babel como el arquetipo de la 'ciudad terrenal', que busca la gloria para sí misma en oposición a la 'Ciudad de Dios'. Nimrod, el 'cazador delante del Señor', es visto no como alguien que caza para Dios, sino como uno que desafía a Dios en su propia cara. Su reino representa el orgullo humano y el deseo de poder que culminará en la construcción de la Torre de Babel." },
                // Terms for Genesis 11
                saphah: { original: "שָׂפָה", transliteration: "śāp̄āh", meaning: "'Lengua', 'labio', 'idioma'. Aquí se usa junto con 'palabras' para enfatizar una unidad total de comunicación y propósito entre los hombres.", commentary: "<strong>Joseph Ratzinger (Benedicto XVI), 'En el principio creó Dios':</strong> 'La unidad de lengua no es solo un hecho lingüístico, sino la expresión de una unidad espiritual y de una voluntad común. Esta unidad, sin embargo, se vuelve peligrosa cuando se dirige hacia un proyecto de auto-glorificación y autosuficiencia que excluye a Dios, como en Babel.'" },
                lebenah: { original: "לְבֵנָה", transliteration: "leḇēnāh", meaning: "'Ladrillo'. A diferencia de la piedra, que es una creación natural de Dios, el ladrillo es un producto de la tecnología humana. Su uso aquí es significativo.", commentary: "El texto subraya que usaron ladrillo 'en lugar de piedra' y asfalto 'en lugar de mortero'. Esto representa un intento de construir una civilización basada en la invención humana, independiente de los materiales provistos por el Creador. Es un símbolo de la autosuficiencia que busca reemplazar la dependencia de Dios por la confianza en la propia capacidad técnica." },
                babel: { original: "בָּבֶל", transliteration: "Bāḇel", meaning: "El nombre de la ciudad, que en acadio (Bāb-ili) significa 'Puerta de Dios', es reinterpretado irónicamente en hebreo a partir del verbo 'bālal', que significa 'confundir'.", commentary: "<strong>CIC 57:</strong> 'La torre de Babel, símbolo de la soberbia colectiva, es el reverso de Pentecostés. La confusión de lenguas castiga el orgullo del hombre que intenta construir la unidad por sus propias fuerzas. En Pentecostés, el Espíritu Santo crea la unidad en la diversidad, permitiendo que todos entiendan el único Evangelio en su propia lengua. Babel es la deconstrucción; Pentecostés es la reconstrucción en Cristo.'" }
            };
            const ref = (key, num) => `<span class="ref-link" data-term='${JSON.stringify(terms[key]).replace(/'/g, "&#39;")}'><sup>${num}</sup></span>`;

            // --- COMPLETE BIBLE DATA (VERIFIED WITH VATICAN.VA) ---
            const bibleData = [
                // Old Testament - 46 Books
                {
                    name: "Génesis",
                    testament: "OT",
                    chapters: [
                        // Capítulo 1 (con teología)
                        [
                            { verse: 1, text: `En el principio creó ${ref('bara', 1)} Dios los cielos y la tierra.` },
                            { verse: 2, text: `La tierra era un caos informe y vacío ${ref('tohu', 2)}, y la oscuridad cubría el abismo, mientras un viento de Dios ${ref('ruach', 3)} se cernía sobre las aguas.` },
                            { verse: 3, text: `Dijo Dios: «Haya luz», y hubo luz.` },
                            { verse: 4, text: `Vio Dios que la luz era buena, y separó Dios la luz de la oscuridad.` },
                            { verse: 5, text: `Llamó Dios a la luz «Día» ${ref('yom', 4)}, y a la oscuridad llamó «Noche». Pasó una tarde, pasó una mañana: el día primero.` },
                            { verse: 6, text: `Dijo Dios: «Haya un firmamento entre las aguas, que separe aguas de aguas».` },
                            { verse: 7, text: `Hizo Dios el firmamento y separó las aguas de debajo del firmamento de las aguas de encima del firmamento. Y así fue.` },
                            { verse: 8, text: `Llamó Dios al firmamento «Cielo». Pasó una tarde, pasó una mañana: el día segundo.` },
                            { verse: 9, text: `Dijo Dios: «Júntense las aguas de debajo de los cielos en un solo lugar, y que aparezca lo seco». Y así fue.` },
                            { verse: 10, text: `Llamó Dios a lo seco «Tierra», y a la masa de las aguas llamó «Mar». Y vio Dios que era bueno.` },
                            { verse: 11, text: `Dijo Dios: «Produzca la tierra vegetación: hierbas que den semilla y árboles frutales que den fruto según su especie, con su semilla dentro, sobre la tierra». Y así fue.` },
                            { verse: 12, text: `La tierra produjo vegetación: hierbas que dan semilla según su especie, y árboles que dan fruto con su semilla dentro, según su especie. Y vio Dios que era bueno.` },
                            { verse: 13, text: `Pasó una tarde, pasó una mañana: el día tercero.` },
                            { verse: 14, text: `Dijo Dios: «Haya lumbreras en el firmamento del cielo para separar el día de la noche, y que sirvan de señales para las fiestas, los días y los años;` },
                            { verse: 15, text: `y que sirvan de lumbreras en el firmamento del cielo para alumbrar sobre la tierra». Y así fue.` },
                            { verse: 16, text: `Hizo Dios las dos grandes lumbreras: la lumbrera mayor para regir el día, y la lumbrera menor para regir la noche; y las estrellas.` },
                            { verse: 17, text: `Las puso Dios en el firmamento del cielo para alumbrar sobre la tierra,` },
                            { verse: 18, text: `para regir el día y la noche, y para separar la luz de la oscuridad. Y vio Dios que era bueno.` },
                            { verse: 19, text: `Pasó una tarde, pasó una mañana: el día cuarto.` },
                            { verse: 20, text: `Dijo Dios: «Bullan las aguas de seres vivos, y que las aves vuelen sobre la tierra, por el firmamento del cielo».` },
                            { verse: 21, text: `Creó Dios los grandes monstruos marinos y todos los seres vivos que se mueven y que las aguas bullen según sus especies, y todas las aves aladas según sus especies. Y vio Dios que era bueno.` },
                            { verse: 22, text: `Los bendijo Dios, diciendo: «Sean fecundos y multiplíquense, y llenen las aguas de los mares; y que las aves se multipliquen en la tierra».` },
                            { verse: 23, text: `Pasó una tarde, pasó una mañana: el día quinto.` },
                            { verse: 24, text: `Dijo Dios: «Produzca la tierra seres vivos según sus especies: ganados, reptiles y bestias de la tierra según sus especies». Y así fue.` },
                            { verse: 25, text: `Hizo Dios las bestias de la tierra según sus especies, los ganados según sus especies y todos los reptiles del campo según sus especies. Y vio Dios que era bueno.` },
                            { verse: 26, text: `Dijo Dios: «Hagamos al hombre a nuestra imagen ${ref('tzelem', 5)}, según nuestra semejanza; que domine los peces del mar, las aves del cielo, los ganados, y a toda la tierra, y a todos los reptiles que se arrastran por la tierra».` },
                            { verse: 27, text: `Y creó Dios al hombre a su imagen, a imagen de Dios lo creó; varón y mujer los creó.` },
                            { verse: 28, text: `Y los bendijo Dios, y les dijo Dios: «Sean fecundos y multiplíquense, llenen la tierra y sométanla; dominen los peces del mar, las aves del cielo y todos los animales que se mueven sobre la tierra».` },
                            { verse: 29, text: `Dijo Dios: «Miren, les doy toda hierba que da semilla sobre la faz de toda la tierra, y todo árbol que tiene fruto que da semilla; esto les servirá de alimento.` },
                            { verse: 30, text: `Y a toda bestia de la tierra, a toda ave del cielo y a todo lo que se arrastra sobre la tierra, que tiene aliento de vida, toda hierba verde les doy por alimento». Y así fue.` },
                            { verse: 31, text: `Vio Dios todo lo que había hecho, y he aquí que era muy bueno. Pasó una tarde, pasó una mañana: el día sexto.` }
                        ],
                        // Capítulo 2 (con teología)
                        [
                            { verse: 1, text: "Así quedaron concluidos los cielos y la tierra con todo su ejército." },
                            { verse: 2, text: `Y concluyó Dios en el día séptimo la obra que había hecho, y descansó${ref('shabbat', 15)} el día séptimo de toda la obra que había hecho.` },
                            { verse: 3, text: "Y bendijo Dios el día séptimo y lo santificó, porque en él descansó de toda la obra que Dios había creado y hecho." },
                            { verse: 4, text: "Estos son los orígenes de los cielos y de la tierra cuando fueron creados, el día en que el Señor Dios hizo la tierra y los cielos." },
                            { verse: 5, text: "No había aún en la tierra ningún arbusto del campo, ni había brotado aún ninguna hierba del campo, porque el Señor Dios no había hecho llover sobre la tierra, ni había hombre para labrar el suelo," },
                            { verse: 6, text: "sino que subía de la tierra un vapor que regaba toda la faz del suelo." },
                            { verse: 7, text: `Entonces el Señor Dios formó al hombre del polvo del suelo${ref('adamah', 16)}, sopló en su nariz aliento de vida${ref('neshamah', 17)}, y fue el hombre un ser viviente.` },
                            { verse: 8, text: `Y el Señor Dios plantó un jardín en Edén${ref('ganeden', 18)}, al oriente, y puso allí al hombre que había formado.` },
                            { verse: 9, text: "El Señor Dios hizo brotar del suelo toda clase de árboles agradables a la vista y buenos para comer; y el árbol de la vida en medio del jardín, y el árbol del conocimiento del bien y del mal." },
                            { verse: 10, text: "Y salía de Edén un río para regar el jardín, y de allí se repartía en cuatro brazos." },
                            { verse: 11, text: "El nombre del primero era Pisón; este es el que rodea toda la tierra de Havila, donde hay oro." },
                            { verse: 12, text: "Y el oro de aquella tierra es bueno; hay allí bedelio y piedra de ónice." },
                            { verse: 13, text: "El nombre del segundo río es Gihón; este es el que rodea toda la tierra de Cus." },
                            { verse: 14, text: "Y el nombre del tercer río es Hidekel; este es el que va al oriente de Asiria. Y el cuarto río es el Éufrates." },
                            { verse: 15, text: "Tomó, pues, el Señor Dios al hombre, y lo puso en el jardín de Edén, para que lo labrara y lo guardase." },
                            { verse: 16, text: "Y mandó el Señor Dios al hombre, diciendo: «De todo árbol del jardín podrás comer;" },
                            { verse: 17, text: "mas del árbol del conocimiento del bien y del mal no comerás; porque el día que de él comieres, ciertamente morirás»." },
                            { verse: 18, text: `Y dijo el Señor Dios: «No es bueno que el hombre esté solo; le haré una ayuda idónea${ref('ezerkenegdo', 19)} para él».` },
                            { verse: 19, text: "El Señor Dios formó, pues, de la tierra toda bestia del campo y toda ave de los cielos, y las trajo a Adán para que viese cómo las había de llamar; y todo lo que Adán llamó a los animales vivientes, ese es su nombre." },
                            { verse: 20, text: "Y puso Adán nombre a toda bestia y ave de los cielos y a todo ganado del campo; mas para Adán no se halló ayuda idónea para él." },
                            { verse: 21, text: "Entonces el Señor Dios hizo caer un sueño profundo sobre Adán, y mientras este dormía, tomó una de sus costillas y cerró la carne en su lugar." },
                            { verse: 22, text: "Y de la costilla que el Señor Dios tomó del hombre, hizo una mujer, y la trajo al hombre." },
                            { verse: 23, text: "Dijo entonces Adán: «Esto es ahora hueso de mis huesos y carne de mi carne; esta será llamada Varona, porque del varón fue tomada»." },
                            { verse: 24, text: "Por tanto, dejará el hombre a su padre y a su madre, y se unirá a su mujer, y serán una sola carne." },
                            { verse: 25, text: "Y estaban ambos desnudos, Adán y su mujer, y no se avergonzaban." }
                        ],
                        ...Array.from({ length: 6 }, (_, i) => [{ verse: 1, text: `[Texto del capítulo ${i + 3} no cargado para optimizar el rendimiento.]` }]),
                        // Capítulo 9 (con teología)
                        [
                            { verse: 1, text: "Bendijo Dios a Noé y a sus hijos, y les dijo: «Sean fecundos, multiplíquense y llenen la tierra." },
                            { verse: 2, text: "Infundiré temor y espanto de ustedes en todos los animales de la tierra, en todas las aves del cielo, en todo lo que se mueve por el suelo y en todos los peces del mar; quedan en sus manos." },
                            { verse: 3, text: "Todo lo que se mueve y tiene vida les servirá de alimento; se lo doy todo, como les di la hierba verde." },
                            { verse: 4, text: `Pero no comerán carne con su vida, es decir, con su sangre ${ref('nefesh', 6)}.` },
                            { verse: 5, text: "Pediré cuentas de la sangre de ustedes, que es su vida; se la pediré a cualquier animal. Y al hombre le pediré cuentas de la vida de su prójimo." },
                            { verse: 6, text: "Si alguien derrama la sangre de un hombre, otro hombre derramará su sangre; porque a imagen de Dios fue hecho el hombre." },
                            { verse: 7, text: "Ustedes, sean fecundos y multiplíquense, pululen por la tierra y domínenla»." },
                            { verse: 8, text: "Dijo Dios a Noé y a sus hijos con él:" },
                            { verse: 9, text: `«Miren, yo establezco mi alianza ${ref('berit', 7)} con ustedes y con su descendencia después de ustedes,` },
                            { verse: 10, text: "y con todo ser viviente que está con ustedes: aves, ganados y todas las fieras de la tierra que están con ustedes; con todos los que salieron del arca, con todo animal de la tierra." },
                            { verse: 11, text: "Establezco mi alianza con ustedes: nunca más será exterminada toda carne por las aguas del diluvio, ni habrá más diluvio para destruir la tierra»." },
                            { verse: 12, text: "Y dijo Dios: «Esta es la señal de la alianza que pongo entre yo y ustedes y todo ser viviente que está con ustedes, por generaciones perpetuas:" },
                            { verse: 13, text: `Pongo mi arco ${ref('qeshet', 8)} en las nubes, y servirá de señal de la alianza entre yo y la tierra.` },
                            { verse: 14, text: "Cuando yo cubra de nubes la tierra y aparezca el arco en las nubes," },
                            { verse: 15, text: "me acordaré de mi alianza, la que existe entre yo y ustedes y todo ser viviente de toda carne, y las aguas no volverán a ser un diluvio para destruir toda carne." },
                            { verse: 16, text: "Estará el arco en las nubes, y yo lo veré para acordarme de la alianza perpetua entre Dios y todo ser viviente de toda carne que hay sobre la tierra»." },
                            { verse: 17, text: "Y dijo Dios a Noé: «Esta es la señal de la alianza que he establecido entre yo y toda carne que hay sobre la tierra»." },
                            { verse: 18, text: "Los hijos de Noé que salieron del arca fueron Sem, Cam y Jafet. Cam es el padre de Canaán." },
                            { verse: 19, text: "Estos tres fueron los hijos de Noé, y a partir de ellos se pobló toda la tierra." },
                            { verse: 20, text: "Noé, que era agricultor, comenzó a plantar una viña." },
                            { verse: 21, text: "Bebió del vino, se embriagó y quedó desnudo en medio de su tienda." },
                            { verse: 22, text: "Cam, padre de Canaán, vio la desnudez de su padre y salió a contárselo a sus dos hermanos." },
                            { verse: 23, text: "Entonces Sem y Jafet tomaron un manto, se lo echaron sobre los hombros y, caminando hacia atrás, cubrieron la desnudez de su padre. Como sus rostros estaban vueltos, no vieron la desnudez de su padre." },
                            { verse: 24, text: "Cuando Noé despertó de su embriaguez y supo lo que le había hecho su hijo menor," },
                            { verse: 25, text: "dijo: «¡Maldito sea Canaán! Será el siervo más bajo de sus hermanos»." },
                            { verse: 26, text: "Y añadió: «¡Bendito sea el Señor, el Dios de Sem! ¡Que Canaán sea su siervo!" },
                            { verse: 27, text: "¡Que Dios engrandezca a Jafet! ¡Que habite en las tiendas de Sem, y que Canaán sea su siervo!»." },
                            { verse: 28, text: "Vivió Noé después del diluvio trescientos cincuenta años." },
                            { verse: 29, text: "El total de los días de Noé fue de novecientos cincuenta años, y murió." }
                        ],
                        // Capítulo 10 (con teología)
                        [
                            { verse: 1, text: "Esta es la descendencia de los hijos de Noé: Sem, Cam y Jafet, a quienes les nacieron hijos después del diluvio." },
                            { verse: 2, text: "Los hijos de Jafet: Gómer, Magog, Maday, Javán, Tubal, Mésec y Tiras." },
                            { verse: 3, text: "Los hijos de Gómer: Asquenaz, Rifat y Togarma." },
                            { verse: 4, text: "Los hijos de Javán: Elisa, Tarsis, Quitim y Dodanim." },
                            { verse: 5, text: `A partir de estos se poblaron las islas de las naciones${ref('goyim', 9)}, en sus diversas tierras, cada cual según su lengua${ref('lashon', 10)}, por sus clanes y en sus naciones.` },
                            { verse: 6, text: "Los hijos de Cam: Cus, Misrayim, Put y Canaán." },
                            { verse: 7, text: "Los hijos de Cus: Seba, Javilá, Sabtá, Ragama y Sabtecá. Los hijos de Ragama: Seba y Dedán." },
                            { verse: 8, text: `Cus engendró a Nimrod${ref('nimrod', 11)}, que fue el primer hombre poderoso en la tierra.` },
                            { verse: 9, text: "Era un valiente cazador delante del Señor. Por eso se dice: «Como Nimrod, valiente cazador delante del Señor»." },
                            { verse: 10, text: "El comienzo de su reino fue Babel, Erec, Acad y Calné, en la tierra de Sinar." },
                            { verse: 11, text: "De aquella tierra salió para Asur y edificó Nínive, Rejobot Ir, Cala," },
                            { verse: 12, text: "y Resen, entre Nínive y Cala (aquella es la gran ciudad)." },
                            { verse: 13, text: "Misrayim engendró a los ludeos, a los anameos, a los lehabitas, a los naftujitas," },
                            { verse: 14, text: "a los patruseos, a los caslujitas (de donde salieron los filisteos) y a los caftoritas." },
                            { verse: 15, text: "Canaán engendró a Sidón, su primogénito, y a Het," },
                            { verse: 16, text: "y al jebuseo, al amorreo, al guirgaseo," },
                            { verse: 17, text: "al heveo, al araceo, al sineo," },
                            { verse: 18, text: "al arvadeo, al semareo y al jamateo. Después se dispersaron los clanes de los cananeos." },
                            { verse: 19, text: "El territorio de los cananeos se extendía desde Sidón, en dirección a Guerar, hasta Gaza; y en dirección a Sodoma, Gomorra, Admá y Seboyim, hasta Lasa." },
                            { verse: 20, text: `Estos son los hijos de Cam, por sus clanes y lenguas${ref('lashon', 10)}, en sus tierras y naciones${ref('goyim', 9)}.` },
                            { verse: 21, text: "También a Sem, padre de todos los hijos de Héber y hermano mayor de Jafet, le nacieron hijos." },
                            { verse: 22, text: "Los hijos de Sem: Elam, Asur, Arfaxad, Lud y Aram." },
                            { verse: 23, text: "Los hijos de Aram: Us, Hul, Guéter y Mas." },
                            { verse: 24, text: "Arfaxad engendró a Sala, y Sala engendró a Héber." },
                            { verse: 25, text: "A Héber le nacieron dos hijos: el nombre de uno fue Péleg, porque en sus días se dividió la tierra; y el nombre de su hermano, Joctán." },
                            { verse: 26, text: "Joctán engendró a Almodad, Sélef, Jasarmávet, Yéraj," },
                            { verse: 27, text: "Hadoram, Uzal, Diclá," },
                            { verse: 28, text: "Obal, Abimael, Seba," },
                            { verse: 29, text: "Ofir, Javilá y Jobab. Todos estos fueron hijos de Joctán." },
                            { verse: 30, text: "El lugar donde habitaron se extendía desde Mesá en dirección a Sefar, la montaña de oriente." },
                            { verse: 31, text: `Estos son los hijos de Sem, por sus clanes y lenguas${ref('lashon', 10)}, en sus tierras y naciones${ref('goyim', 9)}.` },
                            { verse: 32, text: `Estos son los clanes de los hijos de Noé, según sus genealogías, en sus naciones${ref('goyim', 9)}. A partir de ellos se dispersaron las naciones por la tierra después del diluvio.` }
                        ],
                        // Capítulo 11 (con teología)
                        [
                            { verse: 1, text: `Tenía entonces toda la tierra una sola lengua${ref('saphah', 12)} y unas mismas palabras.` },
                            { verse: 2, text: "Y aconteció que, cuando salieron de oriente, hallaron una llanura en la tierra de Sinar, y se establecieron allí." },
                            { verse: 3, text: `Y se dijeron unos a otros: «Vamos, hagamos ladrillo${ref('lebenah', 13)} y cozámoslo con fuego». Y les sirvió el ladrillo en lugar de piedra, y el asfalto en lugar de mezcla.` },
                            { verse: 4, text: "Y dijeron: «Vamos, edifiquémonos una ciudad y una torre, cuya cúspide llegue al cielo; y hagámonos un nombre, por si fuéremos esparcidos sobre la faz de toda la tierra»." },
                            { verse: 5, text: "Y descendió el Señor para ver la ciudad y la torre que edificaban los hijos de los hombres." },
                            { verse: 6, text: "Y dijo el Señor: «He aquí el pueblo es uno, y todos estos tienen un solo lenguaje; y han comenzado la obra, y nada les hará desistir ahora de lo que han pensado hacer." },
                            { verse: 7, text: "Ahora, pues, descendamos, y confundamos allí su lengua, para que ninguno entienda el habla de su compañero»." },
                            { verse: 8, text: "Así los esparció el Señor desde allí sobre la faz de toda la tierra, y dejaron de edificar la ciudad." },
                            { verse: 9, text: `Por esto fue llamado el nombre de ella Babel${ref('babel', 14)}, porque allí confundió el Señor el lenguaje de toda la tierra, y desde allí los esparció sobre la faz de toda la tierra.` },
                            { verse: 10, text: "Estas son las generaciones de Sem: Sem, de edad de cien años, engendró a Arfaxad, dos años después del diluvio." },
                            { verse: 11, text: "Y vivió Sem, después que engendró a Arfaxad, quinientos años, y engendró hijos e hijas." },
                            { verse: 12, text: "Arfaxad vivió treinta y cinco años, y engendró a Sala." },
                            { verse: 13, text: "Y vivió Arfaxad, después que engendró a Sala, cuatrocientos tres años, y engendró hijos e hijas." },
                            { verse: 14, text: "Sala vivió treinta años, y engendró a Héber." },
                            { verse: 15, text: "Y vivió Sala, después que engendró a Héber, cuatrocientos tres años, y engendró hijos e hijas." },
                            { verse: 16, text: "Héber vivió treinta y cuatro años, y engendró a Péleg." },
                            { verse: 17, text: "Y vivió Héber, después que engendró a Péleg, cuatrocientos treinta años, y engendró hijos e hijas." },
                            { verse: 18, text: "Péleg vivió treinta años, y engendró a Reu." },
                            { verse: 19, text: "Y vivió Péleg, después que engendró a Reu, doscientos nueve años, y engendró hijos e hijas." },
                            { verse: 20, text: "Reu vivió treinta y dos años, y engendró a Serug." },
                            { verse: 21, text: "Y vivió Reu, después que engendró a Serug, doscientos siete años, y engendró hijos e hijas." },
                            { verse: 22, text: "Serug vivió treinta años, y engendró a Nacor." },
                            { verse: 23, text: "Y vivió Serug, después que engendró a Nacor, doscientos años, y engendró hijos e hijas." },
                            { verse: 24, text: "Nacor vivió veintinueve años, y engendró a Taré." },
                            { verse: 25, text: "Y vivió Nacor, después que engendró a Taré, ciento diecinueve años, y engendró hijos e hijas." },
                            { verse: 26, text: "Taré vivió setenta años, y engendró a Abram, a Nacor y a Harán." },
                            { verse: 27, text: "Estas son las generaciones de Taré: Taré engendró a Abram, a Nacor y a Harán; y Harán engendró a Lot." },
                            { verse: 28, text: "Y murió Harán antes que su padre Taré en la tierra de su nacimiento, en Ur de los caldeos." },
                            { verse: 29, text: "Y tomaron Abram y Nacor para sí mujeres; el nombre de la mujer de Abram era Sarai, y el nombre de la mujer de Nacor, Milca, hija de Harán, padre de Milca y de Isca." },
                            { verse: 30, text: "Mas Sarai era estéril, y no tenía hijo." },
                            { verse: 31, text: "Y tomó Taré a Abram su hijo, y a Lot hijo de Harán, hijo de su hijo, y a Sarai su nuera, mujer de Abram su hijo, y salió con ellos de Ur de los caldeos, para ir a la tierra de Canaán; y vinieron hasta Harán, y moraron allí." },
                            { verse: 32, text: "Y fueron los días de Taré doscientos cinco años; y murió Taré en Harán." }
                        ],
                        // Placeholder for remaining chapters
                        ...Array.from({ length: 39 }, (_, i) => [{ verse: 1, text: `[Texto del capítulo ${i + 12} no cargado para optimizar el rendimiento.]` }])
                    ]
                },
                { name: "Éxodo", testament: "OT", chapters: placeholderChapter(40) },
                { name: "Levítico", testament: "OT", chapters: placeholderChapter(27) },
                { name: "Números", testament: "OT", chapters: placeholderChapter(36) },
                { name: "Deuteronomio", testament: "OT", chapters: placeholderChapter(34) },
                { name: "Josué", testament: "OT", chapters: placeholderChapter(24) },
                { name: "Jueces", testament: "OT", chapters: placeholderChapter(21) },
                { name: "Rut", testament: "OT", chapters: placeholderChapter(4) },
                { name: "1 Samuel", testament: "OT", chapters: placeholderChapter(31) },
                { name: "2 Samuel", testament: "OT", chapters: placeholderChapter(24) },
                { name: "1 Reyes", testament: "OT", chapters: placeholderChapter(22) },
                { name: "2 Reyes", testament: "OT", chapters: placeholderChapter(25) },
                { name: "1 Crónicas", testament: "OT", chapters: placeholderChapter(29) },
                { name: "2 Crónicas", testament: "OT", chapters: placeholderChapter(36) },
                { name: "Esdras", testament: "OT", chapters: placeholderChapter(10) },
                { name: "Nehemías", testament: "OT", chapters: placeholderChapter(13) },
                { name: "Tobías", testament: "OT", chapters: placeholderChapter(14) },
                { name: "Judit", testament: "OT", chapters: placeholderChapter(16) },
                { name: "Ester", testament: "OT", chapters: placeholderChapter(10) },
                { name: "1 Macabeos", testament: "OT", chapters: placeholderChapter(16) },
                { name: "2 Macabeos", testament: "OT", chapters: placeholderChapter(15) },
                { name: "Job", testament: "OT", chapters: placeholderChapter(42) },
                { name: "Salmos", testament: "OT", chapters: placeholderChapter(150) },
                { name: "Proverbios", testament: "OT", chapters: placeholderChapter(31) },
                { name: "Eclesiastés", testament: "OT", chapters: placeholderChapter(12) },
                { name: "Cantar de los Cantares", testament: "OT", chapters: placeholderChapter(8) },
                { name: "Sabiduría", testament: "OT", chapters: placeholderChapter(19) },
                { name: "Eclesiástico (Sirácida)", testament: "OT", chapters: placeholderChapter(51) },
                { name: "Isaías", testament: "OT", chapters: placeholderChapter(66) },
                { name: "Jeremías", testament: "OT", chapters: placeholderChapter(52) },
                { name: "Lamentaciones", testament: "OT", chapters: placeholderChapter(5) },
                { name: "Baruc", testament: "OT", chapters: placeholderChapter(6) },
                { name: "Ezequiel", testament: "OT", chapters: placeholderChapter(48) },
                { name: "Daniel", testament: "OT", chapters: placeholderChapter(14) },
                { name: "Oseas", testament: "OT", chapters: placeholderChapter(14) },
                { name: "Joel", testament: "OT", chapters: placeholderChapter(4) },
                { name: "Amós", testament: "OT", chapters: placeholderChapter(9) },
                { name: "Abdías", testament: "OT", chapters: placeholderChapter(1) },
                { name: "Jonás", testament: "OT", chapters: placeholderChapter(4) },
                { name: "Miqueas", testament: "OT", chapters: placeholderChapter(7) },
                { name: "Nahúm", testament: "OT", chapters: placeholderChapter(3) },
                { name: "Habacuc", testament: "OT", chapters: placeholderChapter(3) },
                { name: "Sofonías", testament: "OT", chapters: placeholderChapter(3) },
                { name: "Ageo", testament: "OT", chapters: placeholderChapter(2) },
                { name: "Zacarías", testament: "OT", chapters: placeholderChapter(14) },
                { name: "Malaquías", testament: "OT", chapters: placeholderChapter(3) },
                // New Testament - 27 Books
                { name: "Mateo", testament: "NT", chapters: placeholderChapter(28) },
                { name: "Marcos", testament: "NT", chapters: placeholderChapter(16) },
                { name: "Lucas", testament: "NT", chapters: placeholderChapter(24) },
                { name: "Juan", testament: "NT", chapters: placeholderChapter(21) },
                { name: "Hechos de los Apóstoles", testament: "NT", chapters: placeholderChapter(28) },
                { name: "Romanos", testament: "NT", chapters: placeholderChapter(16) },
                { name: "1 Corintios", testament: "NT", chapters: placeholderChapter(16) },
                { name: "2 Corintios", testament: "NT", chapters: placeholderChapter(13) },
                { name: "Gálatas", testament: "NT", chapters: placeholderChapter(6) },
                { name: "Efesios", testament: "NT", chapters: placeholderChapter(6) },
                { name: "Filipenses", testament: "NT", chapters: placeholderChapter(4) },
                { name: "Colosenses", testament: "NT", chapters: placeholderChapter(4) },
                { name: "1 Tesalonicenses", testament: "NT", chapters: placeholderChapter(5) },
                { name: "2 Tesalonicenses", testament: "NT", chapters: placeholderChapter(3) },
                { name: "1 Timoteo", testament: "NT", chapters: placeholderChapter(6) },
                { name: "2 Timoteo", testament: "NT", chapters: placeholderChapter(4) },
                { name: "Tito", testament: "NT", chapters: placeholderChapter(3) },
                { name: "Filemón", testament: "NT", chapters: placeholderChapter(1) },
                { name: "Hebreos", testament: "NT", chapters: placeholderChapter(13) },
                { name: "Santiago", testament: "NT", chapters: placeholderChapter(5) },
                { name: "1 Pedro", testament: "NT", chapters: placeholderChapter(5) },
                { name: "2 Pedro", testament: "NT", chapters: placeholderChapter(3) },
                { name: "1 Juan", testament: "NT", chapters: placeholderChapter(5) },
                { name: "2 Juan", testament: "NT", chapters: placeholderChapter(1) },
                { name: "3 Juan", testament: "NT", chapters: placeholderChapter(1) },
                { name: "Judas", testament: "NT", chapters: placeholderChapter(1) },
                { name: "Apocalipsis", testament: "NT", chapters: placeholderChapter(22) },
            ];

            // --- COMPLETE LITURGICAL DATA GENERATOR ---
            function getLiturgyForDate(date) {
                const year = date.getFullYear();
                if (year !== 2025) return null;

                const toYYYYMMDD = d => `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                const dateString = toYYYYMMDD(date);
                
                const easter = new Date(2025, 3, 20);
                const firstSundayOfAdvent = new Date(2025, 10, 30);

                let season = 'Ordinary Time';
                let seasonColor = '#16a34a'; // green-600
                if (date >= firstSundayOfAdvent && date < new Date(2025, 11, 25)) { season = 'Advent'; seasonColor = '#6d28d9'; } // violet-700
                else if ((date >= new Date(2025, 11, 25)) || (date < new Date(2025, 0, 12))) { season = 'Christmas'; seasonColor = '#ca8a04'; } // yellow-600
                else if (date >= new Date(2025, 2, 5) && date < easter) { season = 'Lent'; seasonColor = '#9333ea'; } // purple-600
                else if (date >= easter && date <= addDays(easter, 50)) { season = 'Easter'; seasonColor = '#f59e0b'; } // amber-500

                let liturgy = {
                    title: '', cycle: '', omitGloria: false, omitCredo: false, omitAlleluia: false, seasonColor: seasonColor,
                    prayers: { collect: '', offerings: '', postCommunion: '', preface: ''},
                    readings: { firstReading: null, psalm: null, secondReading: null, alleluiaVerse: null, gospelAcclamationVerse: null, gospel: null }
                };
                
                const placeholderReadings = {
                    firstReading: { ref: 'Lectura I', text: 'Texto de la primera lectura no disponible.' },
                    psalm: { ref: 'Salmo Responsorial', response: 'Respuesta del salmo.', stanzas: ['Estrofa del salmo no disponible.'] },
                    secondReading: { ref: 'Lectura II', text: 'Texto de la segunda lectura no disponible.' },
                    alleluiaVerse: 'Versículo del Aleluya no disponible.',
                    gospel: { ref: 'Evangelio', text: 'Texto del Evangelio no disponible.' }
                };

                // --- SEASONAL FLAGS ---
                if (season === 'Advent' || season === 'Lent') { liturgy.omitGloria = true; }
                if (season === 'Lent') { liturgy.omitAlleluia = true; }

                // --- SOLEMNITIES AND FEASTS (OVERRIDE SUNDAY LOGIC) ---
                const solemnities = {
                    '2025-01-01': { title: 'Santa María, Madre de Dios', seasonColor: '#e5e7eb' },
                    '2025-01-05': { title: 'Epifanía del Señor', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-01-12': { title: 'Bautismo del Señor', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-03-05': { title: 'Miércoles de Ceniza', seasonColor: '#9333ea' },
                    '2025-04-13': { title: 'Domingo de Ramos', seasonColor: '#dc2626' }, // Sunday
                    '2025-04-17': { title: 'Jueves Santo (Misa de la Cena del Señor)', seasonColor: '#e5e7eb' },
                    '2025-04-18': { title: 'Viernes Santo (Pasión del Señor)', seasonColor: '#dc2626' },
                    '2025-04-19': { title: 'Sábado Santo (Vigilia Pascual)', seasonColor: '#f59e0b' },
                    '2025-04-20': { title: 'Domingo de Pascua', seasonColor: '#f59e0b' }, // Sunday
                    '2025-06-01': { title: 'Ascensión del Señor', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-06-08': { title: 'Domingo de Pentecostés', seasonColor: '#dc2626' }, // Sunday
                    '2025-06-15': { title: 'Santísima Trinidad', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-06-22': { title: 'Santísimo Cuerpo y Sangre de Cristo', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-08-15': { title: 'Asunción de la Virgen María', seasonColor: '#e5e7eb' },
                    '2025-11-01': { title: 'Todos los Santos', seasonColor: '#e5e7eb' },
                    '2025-11-23': { title: 'Jesucristo, Rey del Universo', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-12-08': { title: 'Inmaculada Concepción de la Virgen María', seasonColor: '#e5e7eb' },
                    '2025-12-25': { title: 'Natividad del Señor (Navidad)', seasonColor: '#f59e0b' },
                };

                if (solemnities[dateString]) {
                    liturgy.title = solemnities[dateString].title;
                    liturgy.seasonColor = solemnities[dateString].seasonColor;
                    liturgy.cycle = 'Solemnidad';
                    liturgy.readings = placeholderReadings; 
                }

                // --- ORDINARY SUNDAYS (CYCLE C) ---
                if (date.getDay() === 0 && !solemnities[dateString]) {
                     if (dateString === '2025-07-27') {
                        liturgy.title = 'XVII Domingo del Tiempo Ordinario';
                        liturgy.cycle = 'Ciclo C';
                        liturgy.readings = placeholderReadings;
                    } else if (dateString === '2025-08-03') {
                        liturgy.title = 'XVIII Domingo del Tiempo Ordinario';
                        liturgy.cycle = 'Ciclo C';
                        liturgy.readings = placeholderReadings;
                    } else if (dateString === '2025-08-10') {
                        liturgy.title = 'XIX Domingo del Tiempo Ordinario';
                        liturgy.cycle = 'Ciclo C';
                        liturgy.prayers = {
                            collect: 'Dios todopoderoso y eterno, a quien podemos llamar Padre, aumenta en nuestros corazones el espíritu de hijos adoptivos, para que merezcamos entrar un día en la herencia prometida. Por nuestro Señor Jesucristo.',
                            offerings: 'Sé propicio, Señor, a tu pueblo y acepta con bondad estas ofrendas, para que, con la ayuda de tu piedad, a cada uno le aproveche para su salvación lo que ofrece en honor de tu nombre. Por Jesucristo, nuestro Señor.',
                            postCommunion: 'Que la comunión en tus sacramentos nos salve, Señor, y nos afiance en la luz de tu verdad. Por Jesucristo, nuestro Señor.',
                            preface: 'En verdad es justo y necesario, es nuestro deber y salvación darte gracias siempre y en todo lugar, Señor, Padre santo, Dios todopoderoso y eterno. Pues, aunque no necesitas nuestra alabanza, es don tuyo que seamos agradecidos; y aunque nuestras bendiciones no aumentan tu gloria, nos aprovechan para nuestra salvación. Por Cristo, Señor nuestro. Por eso, unidos a los ángeles, te aclamamos llenos de alegría:'
                        };
                        liturgy.readings = {
                            firstReading: { ref: 'Sabiduría 18, 6-9', text: `La noche de la liberación fue anunciada de antemano a nuestros padres, para que tuvieran ánimo al conocer con certeza la promesa de la que se fiaban. Tu pueblo esperaba, a la vez, la salvación de los justos y la perdición de los enemigos. Porque con la misma acción que castigaste a los adversarios, nos glorificaste a nosotros, llamándonos a ti. Los santos hijos de los buenos ofrecían sacrificios a escondidas y establecieron de común acuerdo esta ley divina: que los santos compartirían por igual los mismos bienes y peligros; y entonaron los himnos de los padres.` },
                            psalm: { ref: 'Salmo 32', response: 'Dichoso el pueblo que el Señor se escogió como heredad.', stanzas: [ `Aclamad, justos, al Señor,<br>que merece la alabanza de los buenos.<br>Dichosa la nación cuyo Dios es el Señor,<br>el pueblo que él se escogió como heredad.`, `El Señor mira desde el cielo,<br>se fija en todos los hombres.<br>Desde su morada observa<br>a todos los habitantes de la tierra.`, `Los ojos del Señor están puestos en quien lo teme,<br>en los que esperan en su misericordia,<br>para librar sus vidas de la muerte<br>y reanimarlos en tiempo de hambre.`, `Nosotros aguardamos al Señor:<br>él es nuestro auxilio y escudo;<br>que tu misericordia, Señor, venga sobre nosotros,<br>como lo esperamos de ti.` ] },
                            secondReading: { ref: 'Hebreos 11, 1-2. 8-19', text: `Hermanos: La fe es garantía${ref('hypostasis', 1)} de lo que se espera, la prueba${ref('elenchos', 2)} de las realidades que no se ven. Por ella fueron alabados nuestros mayores. Por la fe, Abrahán, al ser llamado por Dios, obedeció y salió para el lugar que había de recibir en herencia, y salió sin saber a dónde iba. Por la fe, se estableció en la tierra prometida como en tierra extraña, viviendo en tiendas, y lo mismo Isaac y Jacob, herederos de la misma promesa${ref('epangelia', 3)}, pues esperaba la ciudad de sólidos cimientos, cuyo arquitecto y constructor es Dios. Por la fe, también Sara, siendo estéril, obtuvo vigor para concebir, a pesar de su edad avanzada, porque creyó que era fiel el que se lo prometía. Y así, de un solo hombre, y ya marcado por la muerte, nacieron hijos, numerosos como las estrellas del cielo e incontables como la arena de las playas. Con fe murieron todos estos, sin haber recibido las promesas; las vieron y las saludaron de lejos, confesando que eran extraños y peregrinos en la terra. Los que así hablan, dan a entender que buscan una patria; pues si hubieran pensado en la que habían abandonado, tenían ocasión de volver. Pero ellos ansiaban una patria mejor, la celestial. Por eso Dios no se avergüenza de llamarse su Dios, pues les tenía preparada una ciudad. Por la fe, Abrahán, puesto a prueba, ofreció a Isaac; y el que había recibido las promesas, ofrecía a su unigénito, a quien se le había dicho: «La descendencia que lleve tu nombre será la de Isaac». Pero Abrahán pensaba que Dios tiene poder hasta para resucitar de entre los muertos, de donde en cierto sentido lo recobró.` },
                            alleluiaVerse: 'Estad en vela y preparados, porque a la hora que menos penséis viene el Hijo del hombre. (cf. Mt 24, 42a. 44)',
                            gospel: { ref: 'Lucas 12, 32-48', text: `En aquel tiempo, dijo Jesús a sus discípulos: «No temas, pequeño rebaño${ref('poimnion', 4)}, porque vuestro Padre ha tenido a bien daros el reino. Vended vuestros bienes y dad limosna. Haceos bolsas que no se estropeen, un tesoro inagotable en el cielo, adonde no se acercan los ladrones ni roe la polilla. Porque donde está vuestro tesoro, allí estará también vuestro corazón${ref('kardia', 5)}. Tened ceñida la cintura y encendidas las lámparas. Vosotros estad como los hombres que aguardan a que su señor vuelva de la boda, para abrirle apenas venga y llame. Bienaventurados aquellos criados a quienes el señor, al llegar, los encuentre en vela${ref('gregoreō', 6)}; en verdad os digo que se ceñirá, los hará sentar a la mesa y, acercándose, les irá sirviendo. Y, si llega a la segunda vigilia o a la tercera y los encuentra así, ¡bienaventurados ellos! Comprended que si supiera el dueño de casa a qué hora viene el ladrón, no le dejaría abrir un boquete en su casa. Lo mismo vosotros, estad preparados, porque a la hora que menos penséis viene el Hijo del hombre». Pedro le dijo: «Señor, ¿dices esta parábola por nosotros o por todos?». Y el Señor dijo: «¿Quién es el administrador fiel y prudente a quien el señor pondrá al frente de su servidumbre para que reparta la ración de alimento a sus horas? Bienaventurado aquel siervo${ref('doulos', 7)} a quien su señor, al llegar, lo encuentre portándose así. En verdad os digo que lo pondrá al frente de todos sus bienes. Pero si aquel siervo dijere para sus adentros: “Mi señor tarda en llegar”, y empieza a pegarles a los criados y a las criadas, a comer y beber y emborracharse, vendrá el señor de ese siervo el día que menos lo espera y a la hora que no sabe y lo castigará con rigor, y le asignará la suerte de los infieles. El siervo que, conociendo la voluntad de su señor, no se prepara ni obra de acuerdo con su voluntad, recibirá muchos azotes; pero el que, sin conocerla, ha hecho algo digno de azotes, recibirá menos. A quien mucho se le dio, mucho se le reclamará; a quien mucho se le confió, más aún se le pedirá».` }
                        };
                    } else {
                        // Placeholder for other Sundays
                        liturgy.title = `Domingo de ${season}`;
                        liturgy.cycle = 'Ciclo C';
                        liturgy.readings = placeholderReadings;
                    }
                }
                
                if (!liturgy.title) return null; // If no title was set, it's not a liturgical day we're tracking.

                return liturgy;
            }
            
            // --- DOM ELEMENTS & STATE ---
            const splashScreen = document.getElementById('splash-screen');
            const mainContent = document.getElementById('main-content');
            const fullLiturgyView = document.getElementById('full-liturgy-view');
            const backToCalendarBtn = document.getElementById('back-to-calendar-btn');
            const printBtn = document.getElementById('print-btn');
            const downloadDocxBtn = document.getElementById('download-docx-btn');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            const mobileNavLinks = document.getElementById('mobile-nav-links');
            const mainNavButtons = { 
                home: document.getElementById('btn-home'),
                liturgy: document.getElementById('btn-liturgy'), 
                bible: document.getElementById('btn-bible'),
                glossary: document.getElementById('btn-glossary'), 
                lectionary: document.getElementById('btn-lectionary')
            };
            const views = { 
                home: document.getElementById('home-view'),
                liturgy: document.getElementById('liturgy-view'), 
                bible: document.getElementById('bible-view'),
                glossary: document.getElementById('glossary-view'), 
                lectionary: document.getElementById('lectionary-view')
            };
            
            const fullLiturgyUI = { title: document.getElementById('full-liturgy-title'), subtitle: document.getElementById('full-liturgy-subtitle'), content: document.getElementById('full-liturgy-content') };
            const uploadLogoBtn = document.getElementById('btn-upload-logo');
            const logoUploader = document.getElementById('logo-uploader');
            const logoImage = document.getElementById('logo-image');
            const theologyPopup = document.getElementById('theology-popup');
            const theologyPopupOverlay = document.getElementById('theology-popup-overlay');
            const theologyPopupContent = document.getElementById('popup-content-theology');
            const theologyPopupClose = document.getElementById('popup-close');
            const cardsContainer = document.getElementById('liturgical-cards-container');

            // --- BIBLE VIEW ELEMENTS ---
            const bibleHeader = {
                backBtn: document.getElementById('bible-back-btn'),
                title: document.getElementById('bible-view-title')
            };
            const bibleViews = {
                testament: document.getElementById('testament-selector-view'),
                book: document.getElementById('book-selector-view'),
                chapter: document.getElementById('chapter-selector-view'),
                content: document.getElementById('chapter-content-view')
            };
            const bibleSelectors = {
                selectOT: document.getElementById('select-ot'),
                selectNT: document.getElementById('select-nt')
            };
            let bibleNavState = {
                level: 'root', // root, testament, book, chapter
                testament: null,
                bookIndex: null,
                chapterIndex: null
            };

            // --- FUNCTIONS ---
            function switchView(viewName) {
                Object.values(views).forEach(v => v.classList.add('hidden'));
                Object.values(mainNavButtons).forEach(b => b.classList.remove('active-nav'));
                if (views[viewName]) {
                    views[viewName].classList.remove('hidden');
                }
                if (mainNavButtons[viewName]) {
                    mainNavButtons[viewName].classList.add('active-nav');
                }
            }
            
            function renderLiturgicalCards() {
                cardsContainer.innerHTML = '';
                const startDate = new Date(2025, 0, 1);
                const endDate = new Date(2025, 11, 31);

                for (let d = startDate; d <= endDate; d.setDate(d.getDate() + 1)) {
                    const liturgyData = getLiturgyForDate(new Date(d));
                    if (liturgyData) {
                        const card = document.createElement('div');
                        card.className = 'liturgical-card flex items-center p-4 rounded-lg shadow-md cursor-pointer';
                        card.style.borderColor = liturgyData.seasonColor;
                        card.dataset.date = d.toISOString().split('T')[0];
                        
                        card.innerHTML = `
                            <div class="flex-shrink-0 w-20 text-center">
                                <p class="text-gray-500 text-sm">${d.toLocaleDateString('es-ES', { weekday: 'short' }).replace('.', '')}</p>
                                <p class="text-2xl font-bold text-gray-800">${d.getDate()}</p>
                                <p class="text-gray-500 text-sm">${d.toLocaleDateString('es-ES', { month: 'short' }).replace('.', '')}</p>
                            </div>
                            <div class="flex-grow pl-4">
                                <h3 class="font-bold text-lg text-gray-900">${liturgyData.title}</h3>
                                <p class="text-sm text-gray-600">${liturgyData.cycle}</p>
                            </div>
                            <div class="flex-shrink-0">
                               <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        `;
                        cardsContainer.appendChild(card);
                    }
                }
            }

            function showFullLiturgy(date) {
                renderFullLiturgyView(date); 
                mainContent.classList.add('hidden');
                fullLiturgyView.classList.remove('hidden');
                fullLiturgyView.scrollTop = 0;
            }

            function renderFullLiturgyView(date) {
                const liturgy = getLiturgyForDate(date);
                if (liturgy && liturgy.readings && liturgy.readings.firstReading.text !== 'Texto de la primera lectura no disponible.') {
                    fullLiturgyUI.title.textContent = liturgy.title;
                    const formattedDate = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    fullLiturgyUI.subtitle.textContent = `${formattedDate} | ${liturgy.cycle}`;
                    
                    const templates = {
                        initialGreeting: `<h3>Saludo Inicial</h3><p class="liturgy-text">En el nombre del Padre, y del Hijo, y del Espíritu Santo.<br><strong>Amén.</strong><br>La gracia de nuestro Señor Jesucristo, el amor del Padre y la comunión del Espíritu Santo esté con todos ustedes.<br><strong>Y con tu espíritu.</strong></p>`,
                        penitentialAct: `<h3>Acto Penitencial (Libro de Oración Común ACNA)</h3><p class="liturgy-text">Amados en el Señor, acerquémonos con un corazón penitente y obediente a la Palabra de Dios, confesando nuestros pecados para que podamos recibir el perdón por su infinita bondad y misericordia.<br><em>Se guarda un momento de silencio.</em><br><strong>Misericordiosísimo Dios, confesamos que hemos pecado contra ti en pensamiento, palabra y obra, por lo que hemos hecho y por lo que hemos dejado de hacer. No te hemos amado con todo nuestro corazón; no hemos amado a nuestro prójimo como a nosotros mismos. Lo sentimos de veras y nos arrepentimos humildemente. Por tu Hijo Jesucristo, ten misericordia de nosotros y perdónanos, para que nos deleitemos en tu voluntad y andemos en tus caminos, para la gloria de tu Nombre. Amén.</strong><br>Dios todopoderoso tenga misericordia de nosotros, perdone nuestros pecados y nos lleve a la vida eterna.<br><strong>Amén.</strong></p>`,
                        gloria: `<h3>Gloria</h3><p class="liturgy-text"><strong>Gloria a Dios en el cielo, y en la tierra paz a los hombres que ama el Señor. Por tu inmensa gloria te alabamos, te bendecimos, te adoramos, te glorificamos, te damos gracias, Señor Dios, Rey celestial, Dios Padre todopoderoso. Señor, Hijo único, Jesucristo. Señor Dios, Cordero de Dios, Hijo del Padre; tú que quitas el pecado del mundo, ten piedad de nosotros; tú que quitas el pecado del mundo, atiende nuestra súplica; tú que estás sentado a la derecha del Padre, ten piedad de nosotros. Porque sólo tú eres Santo, sólo tú Señor, sólo tú Altísimo, Jesucristo, con el Espíritu Santo en la gloria de Dios Padre. Amén.</strong></p>`,
                        alleluia: (verse) => `<h3>Aleluya</h3><p class="liturgy-text"><strong>Aleluya, aleluya.</strong><br>${verse}<br><strong>Aleluya.</strong></p>`,
                        gospelAcclamation: (verse) => `<h3>Aclamación antes del Evangelio</h3><p class="liturgy-text">${verse}</p>`,
                        gospel: (gospelData) => `<h3>Evangelio: ${gospelData.ref}</h3><p class="liturgy-text">El Señor esté con ustedes.<br><strong>Y con tu espíritu.</strong><br>Lectura del santo Evangelio según san ${gospelData.ref.split(' ')[0]}.<br><strong>Gloria a ti, Señor.</strong></p><p class="liturgy-text">${gospelData.text}</p><p class="liturgy-text">Palabra del Señor.<br><strong>Gloria a ti, Señor Jesús.</strong></p>`,
                        credo: `<h3>Profesión de Fe - Credo Niceno</h3><p class="liturgy-text"><strong>Creo en un solo Dios, Padre todopoderoso, Creador del cielo y de la tierra, de todo lo visible y lo invisible. Creo en un solo Señor, Jesucristo, Hijo único de Dios, nacido del Padre antes de todos los siglos: Dios de Dios, Luz de Luz, Dios verdadero de Dios verdadero, engendrado, no creado, de la misma naturaleza del Padre, por quien todo fue hecho; que por nosotros, los hombres, y por nuestra salvación bajó del cielo, y por obra del Espíritu Santo se encarnó de María, la Virgen, y se hizo hombre; y por nuestra causa fue crucificado en tiempos de Poncio Pilato; padeció y fue sepultado, y resucitó al tercer día, según las Escrituras, y subió al cielo, y está sentado a la derecha del Padre; y de nuevo vendrá con gloria para juzgar a vivos y muertos, y su reino no tendrá fin. Creo en el Espíritu Santo, Señor y dador de vida, que procede del Padre y del Hijo, que con el Padre y del Hijo recibe una misma adoración y gloria, y que habló por los profetas. Creo en la Iglesia, que es una, santa, católica и apostólica. Confieso que hay un solo bautismo para el perdón de los pecados. Espero la resurrección de los muertos y la vida del mundo futuro. Amén.</strong></p>`,
                        prayerOfTheFaithful: `<h3>Oración de los Fieles</h3><p class="liturgy-text">Hermanos, oremos a Dios Padre todopoderoso, que escucha siempre la oración de sus hijos. Digamos con fe:<br><strong>Te rogamos, óyenos.</strong><br><em>(Se presentan las intenciones)</em><br>Escucha, Padre, nuestra oración y concédenos aquellos dones que con fe te pedimos. Por Jesucristo, nuestro Señor.<br><strong>Amén.</strong></p>`,
                        eucharisticPrayerII: (preface) => `<h3>Plegaria Eucarística II</h3><p class="liturgy-text">El Señor esté con ustedes.<br><strong>Y con tu espíritu.</strong><br>Levantemos el corazón.<br><strong>Lo tenemos levantado hacia el Señor.</strong><br>Demos gracias al Señor, nuestro Dios.<br><strong>Es justo y necesario.</strong></p><p class="liturgy-text">${preface}</p><p class="liturgy-text"><strong>Santo, Santo, Santo es el Señor, Dios del Universo. Llenos están el cielo y la tierra de tu gloria. Hosanna en el cielo. Bendito el que viene en nombre del Señor. Hosanna en el cielo.</strong></p><p class="liturgy-text">Santo eres en verdad, Señor, fuente de toda santidad; por eso te pedimos que santifiques estos dones con la efusión de tu Espíritu, de manera que se conviertan para nosotros en el Cuerpo y la Sangre de Jesucristo, nuestro Señor. El cual, cuando iba a ser entregado a su Pasión, voluntariamente aceptada, tomó pan, dándote gracias, lo partió y lo dio a sus discípulos, diciendo: <strong>«TOMEN Y COMAN TODOS DE ÉL, PORQUE ESTO ES MI CUERPO, QUE SERÁ ENTREGADO POR USTEDES».</strong> Del mismo modo, acabada la cena, tomó el cáliz, y, dándote gracias de nuevo, lo pasó a sus discípulos, diciendo: <strong>«TOMEN Y BEBAN TODOS DE ÉL, PORQUE ESTE ES EL CÁLIZ DE MI SANGRE, SANGRE DE LA ALIANZA NUEVA Y ETERNA, QUE SERÁ DERRAMADA POR USTEDES Y POR MUCHOS PARA EL PERDÓN DE LOS PECADOS. HAGAN ESTO EN CONMEMORACIÓN MÍA».</strong> Este es el Misterio de la fe.<br><strong>Anunciamos tu muerte, proclamamos tu resurrección. ¡Ven, Señor Jesús!</strong></p><p class="liturgy-text">Así, pues, Padre, al celebrar ahora el memorial de la muerte y resurrección de tu Hijo, te ofrecemos el pan de vida y el cáliz de salvación, y te damos gracias porque nos haces dignos de servirte en tu presencia. Te pedimos humildemente que el Espíritu Santo congregue en la unidad a cuantos participamos del Cuerpo y la Sangre de Cristo. Por Cristo, con él y en él, a ti, Dios Padre omnipotente, en la unidad del Espíritu Santo, todo honor y toda gloria por los siglos de los siglos.<br><strong>Amén.</strong></p>`,
                        communionRite: `<h3>Rito de la Comunión</h3><p class="liturgy-text">Fieles a la recomendación del Salvador y siguiendo su divina enseñanza, nos atrevemos a decir:<br><strong>Padre nuestro, que estás en el cielo, santificado sea tu Nombre; venga a nosotros tu reino; hágase tu voluntad en la tierra como en el cielo. Danos hoy nuestro pan de cada día; perdona nuestras ofensas, como también nosotros perdonamos a los que nos ofenden; no nos dejes caer en la tentación, y líbranos del mal.</strong><br>Líbranos de todos los males, Señor, y concédenos la paz en nuestros días, para que, ayudados por tu misericordia, vivamos siempre libres de pecado y protegidos de toda perturbación, mientras esperamos la gloriosa venida de nuestro Salvador Jesucristo.<br><strong>Tuyo es el reino, tuyo el poder y la gloria, por siempre, Señor.</strong><br>Señor Jesucristo, que dijiste a tus apóstoles: «La paz les dejo, mi paz les doy», no tengas en cuenta nossos pecados, sino la fe de tu Iglesia y, conforme a tu palabra, concédele la paz y la unidad. Tú que vives y reinas por los siglos de los siglos.<br><strong>Amén.</strong><br>La paz del Señor esté siempre con ustedes.<br><strong>Y con tu espíritu.</strong></p><p class="liturgy-text"><strong>Cordero de Dios, que quitas el pecado del mundo, ten piedad de nosotros.</strong><br><strong>Cordero de Dios, que quitas el pecado del mundo, ten piedad de nosotros.</strong><br><strong>Cordero de Dios, que quitas el pecado del mundo, danos la paz.</strong></p><p class="liturgy-text">Este es el Cordero de Dios, que quita el pecado del mundo. Dichosos los invitados a la cena del Señor.<br><strong>Señor, no soy digno de que entres en mi casa, pero una palabra tuya bastará para sanarme.</strong></p>`,
                        acnaPostCommunion: `<h3>Oración después de la Comunión (ACNA)</h3><p class="liturgy-text"><strong>Padre Celestial, te damos gracias por alimentarnos con el alimento espiritual del preciosísimo Cuerpo y Sangre de tu Hijo nuestro Salvador Jesucristo; y por asegurarnos en estos santos misterios que somos miembros vivos de tu Hijo y herederos de tu reino eterno. Y te suplicamos, oh Señor, que nos asistas con tu gracia, para que continuemos en esa santa confraternidad, y hagamos todas las buenas obras que has preparado para que andemos en ellas; por Jesucristo nuestro Señor, a quien, contigo y el Espíritu Santo, sea todo honor y gloria, por los siglos de los siglos. Amén.</strong></p>`,
                        concludingRites: `<h3>Rito de Conclusión</h3><p class="liturgy-text">El Señor esté con ustedes.<br><strong>Y con tu espíritu.</strong><br>La bendición de Dios todopoderoso, Padre, Hijo, y Espíritu Santo, descienda sobre ustedes y permanezca para siempre.<br><strong>Amén.</strong><br>Pueden ir en paz.<br><strong>Demos gracias a Dios.</strong></p>`
                    };

                    const entranceProcession = `<h3>Procesión de Entrada</h3><p class="liturgy-text italic">(Se canta un himno o antífona de entrada apropiado)</p>`;
                    const introductoryRites = entranceProcession + templates.initialGreeting + templates.penitentialAct + (liturgy.omitGloria ? '' : templates.gloria) + `<h3>Oración Colecta</h3><p class="liturgy-text">${liturgy.prayers.collect}</p>`;
                    
                    let psalmContentHtml = `<strong>R. ${liturgy.readings.psalm.response}</strong><br><br>` + liturgy.readings.psalm.stanzas.join(`<br><br><strong>R. ${liturgy.readings.psalm.response}</strong><br><br>`);

                    let gospelAcclamationHtml = liturgy.omitAlleluia ? templates.gospelAcclamation(liturgy.readings.gospelAcclamationVerse) : templates.alleluia(liturgy.readings.alleluiaVerse);

                    const liturgyOfTheWord = `<h3>Primera Lectura: ${liturgy.readings.firstReading.ref}</h3><p class="liturgy-text">${liturgy.readings.firstReading.text}</p><h3>Salmo Responsorial: ${liturgy.readings.psalm.ref}</h3><p class="liturgy-text">${psalmContentHtml}</p>${liturgy.readings.secondReading ? `<h3>Segunda Lectura: ${liturgy.readings.secondReading.ref}</h3><p class="liturgy-text">${liturgy.readings.secondReading.text}</p>` : ''}${gospelAcclamationHtml}${templates.gospel(liturgy.readings.gospel)}<h3>Homilía</h3><p class="liturgy-text italic">(Reflexión sobre las lecturas)</p>${templates.credo}${templates.prayerOfTheFaithful}`;
                    
                    const liturgyOfTheEucharist = `<h3>Presentación de las Ofrendas</h3><p class="liturgy-text">Oren, hermanos, para que este sacrificio, mío y de ustedes, sea agradable a Dios, Padre todopoderoso.<br><strong>El Señor reciba de tus manos este sacrificio, para alabanza y gloria de su nombre, para nuestro bien y el de toda su santa Iglesia.</strong></p><h3>Oración sobre las Ofrendas</h3><p class="liturgy-text">${liturgy.prayers.offerings}</p>${templates.eucharisticPrayerII(liturgy.prayers.preface)}${templates.communionRite}`;
                    
                    const concludingRites = `<h3>Oración después de la Comunión</h3><p class="liturgy-text">${liturgy.prayers.postCommunion}</p>${templates.acnaPostCommunion}${templates.concludingRites}`;

                    const finalHtml = `<div class="bg-white p-6 rounded-lg shadow-md">
                                        <div class="liturgy-section"><h2>Ritos Iniciales</h2>${introductoryRites}</div>
                                        <div class="liturgy-section"><h2>Liturgia de la Palabra</h2>${liturgyOfTheWord}</div>
                                        <div class="liturgy-section"><h2>Liturgia Eucarística</h2>${liturgyOfTheEucharist}</div>
                                        <div class="liturgy-section"><h2>Ritos de Conclusión</h2>${concludingRites}</div>
                                    </div>`;

                    fullLiturgyUI.content.innerHTML = finalHtml;

                } else {
                    fullLiturgyUI.title.textContent = 'Liturgia no Disponible';
                    fullLiturgyUI.subtitle.textContent = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    fullLiturgyUI.content.innerHTML = `<div class="bg-white p-8 rounded-lg shadow-md text-center"><p class="text-gray-600 py-16">Lo sentimos, la liturgia completa para este día aún no ha sido implementada.</p></div>`;
                }
            }


            function hideFullLiturgy() {
                mainContent.classList.remove('hidden');
                fullLiturgyView.classList.add('hidden');
            }

            function loadLogoFromStorage() {
                const savedLogo = localStorage.getItem('userLogo');
                if (savedLogo) {
                    logoImage.src = savedLogo;
                }
            }

            // --- BIBLE NAVIGATION LOGIC ---
            function updateBibleView() {
                // Hide all views first
                Object.values(bibleViews).forEach(v => v.classList.add('hidden'));

                switch (bibleNavState.level) {
                    case 'testament':
                        bibleViews.book.innerHTML = '';
                        bibleData.forEach((book, index) => {
                            if (book.testament === bibleNavState.testament) {
                                const card = document.createElement('button');
                                card.className = 'bible-book-card text-center p-4 bg-white/70 backdrop-blur-sm rounded-lg shadow hover:bg-teal-100 border border-gray-200';
                                card.textContent = book.name;
                                card.dataset.bookIndex = index;
                                bibleViews.book.appendChild(card);
                            }
                        });
                        bibleHeader.title.textContent = bibleNavState.testament === 'OT' ? 'Antiguo Testamento' : 'Nuevo Testamento';
                        bibleViews.book.classList.remove('hidden');
                        bibleHeader.backBtn.classList.remove('hidden');
                        break;

                    case 'book':
                        const book = bibleData[bibleNavState.bookIndex];
                        bibleViews.chapter.innerHTML = '';
                        // Use book.chapters.length which is the correct number of chapters
                        for (let i = 1; i <= book.chapters.length; i++) {
                            const card = document.createElement('button');
                            card.className = 'bible-chapter-card flex items-center justify-center aspect-square p-2 bg-white/70 backdrop-blur-sm rounded-lg shadow hover:bg-teal-100 border border-gray-200';
                            card.textContent = i;
                            card.dataset.chapterIndex = i - 1;
                            bibleViews.chapter.appendChild(card);
                        }
                        bibleHeader.title.textContent = book.name;
                        bibleViews.chapter.classList.remove('hidden');
                        bibleHeader.backBtn.classList.remove('hidden');
                        break;

                    case 'chapter':
                        const bookData = bibleData[bibleNavState.bookIndex];
                        const chapterData = bookData.chapters[bibleNavState.chapterIndex];
                        bibleViews.content.innerHTML = ''; // Clear previous content
                        
                        chapterData.forEach((verse) => {
                            const p = document.createElement('p');
                            p.className = 'verse-wrapper';
                            if (verse.text.includes('ref-link')) {
                                p.classList.add('has-commentary');
                            }
                            p.innerHTML = `<sup>${verse.verse}</sup>${verse.text}`;
                            bibleViews.content.appendChild(p);
                        });

                        bibleHeader.title.textContent = `${bookData.name} ${bibleNavState.chapterIndex + 1}`;
                        bibleViews.content.classList.remove('hidden');
                        bibleHeader.backBtn.classList.remove('hidden');
                        break;

                    default: // root
                        bibleViews.testament.classList.remove('hidden');
                        bibleHeader.title.textContent = 'Biblia';
                        bibleHeader.backBtn.classList.add('hidden');
                        break;
                }
            }

            // --- THEOLOGY POPUP LOGIC ---
            function showTheologyPopup(event) {
                const refLink = event.target.closest('.ref-link');
                if (refLink) {
                    event.preventDefault();
                    event.stopPropagation();
                    const data = JSON.parse(refLink.dataset.term);
                    
                    let commentaryHtml = data.commentary ? `<hr class="my-3 border-gray-200"><h5 class="text-teal-700 font-bold mt-2">Comentario Teológico</h5><p class="text-sm text-gray-600">${data.commentary}</p>` : '';

                    theologyPopupContent.innerHTML = `
                        <h5 class="text-teal-700 font-bold">${data.transliteration}</h5>
                        <p class="original-term text-gray-700 mb-2">${data.original}</p>
                        <p class="text-gray-800">${data.meaning}</p>
                        ${commentaryHtml}
                    `;
                    
                    theologyPopupOverlay.style.display = 'block';
                    theologyPopup.style.display = 'block';
                    document.body.style.overflow = 'hidden'; 
                }
            }
            
            function closeTheologyPopup() {
                theologyPopup.style.display = 'none';
                theologyPopupOverlay.style.display = 'none';
                document.body.style.overflow = ''; 
            }

            // --- EVENT LISTENERS ---
            Object.keys(mainNavButtons).forEach(key => {
                if(mainNavButtons[key]) {
                    mainNavButtons[key].addEventListener('click', () => switchView(key));
                }
            });

            backToCalendarBtn.addEventListener('click', hideFullLiturgy);
            printBtn.addEventListener('click', () => window.print());
            
            downloadDocxBtn.addEventListener('click', () => {
                const title = fullLiturgyUI.title.textContent;
                const subtitle = fullLiturgyUI.subtitle.textContent;
                const contentElement = document.getElementById('full-liturgy-content').cloneNode(true);

                contentElement.querySelectorAll('.ref-link').forEach(el => {
                    const sup = document.createElement('sup');
                    sup.textContent = el.textContent;
                    el.parentNode.replaceChild(sup, el);
                });

                const liturgyBody = contentElement.querySelector('.bg-white');
                if (!liturgyBody) return;

                const headerHtml = `...`; // Content omitted for brevity
                const twoColumnContent = `<div style="column-count: 2; column-gap: 40px;">${liturgyBody.innerHTML}</div>`;
                const fullHtmlForDocx = `...`; // Content omitted for brevity

                const converted = htmlDocx.asBlob(fullHtmlForDocx, {
                    orientation: 'landscape',
                    margins: { top: 720, right: 720, bottom: 720, left: 720 } 
                });
                saveAs(converted, `${title}.docx`);
            });
            
            cardsContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.liturgical-card');
                if (card && card.dataset.date) {
                    const [year, month, day] = card.dataset.date.split('-').map(Number);
                    const selectedDate = new Date(year, month - 1, day);
                    showFullLiturgy(selectedDate);
                }
            });

            // --- BIBLE EVENT LISTENERS ---
            bibleSelectors.selectOT.addEventListener('click', () => {
                bibleNavState.level = 'testament';
                bibleNavState.testament = 'OT';
                updateBibleView();
            });

            bibleSelectors.selectNT.addEventListener('click', () => {
                bibleNavState.level = 'testament';
                bibleNavState.testament = 'NT';
                updateBibleView();
            });

            bibleViews.book.addEventListener('click', (e) => {
                const card = e.target.closest('.bible-book-card');
                if (card) {
                    bibleNavState.level = 'book';
                    bibleNavState.bookIndex = parseInt(card.dataset.bookIndex);
                    updateBibleView();
                }
            });

            bibleViews.chapter.addEventListener('click', (e) => {
                const card = e.target.closest('.bible-chapter-card');
                if (card) {
                    bibleNavState.level = 'chapter';
                    bibleNavState.chapterIndex = parseInt(card.dataset.chapterIndex);
                    updateBibleView();
                }
            });

            bibleHeader.backBtn.addEventListener('click', () => {
                if (bibleNavState.level === 'chapter') {
                    bibleNavState.level = 'book';
                } else if (bibleNavState.level === 'book') {
                    bibleNavState.level = 'testament';
                } else if (bibleNavState.level === 'testament') {
                    bibleNavState.level = 'root';
                }
                updateBibleView();
            });

            // --- THEOLOGY POPUP LISTENERS ---
            fullLiturgyView.addEventListener('click', showTheologyPopup);
            bibleViews.content.addEventListener('click', showTheologyPopup);
            theologyPopupClose.addEventListener('click', closeTheologyPopup);
            theologyPopupOverlay.addEventListener('click', closeTheologyPopup);

            // --- LOGO UPLOAD LISTENERS ---
            uploadLogoBtn.addEventListener('click', () => logoUploader.click());

            logoUploader.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const logoDataUrl = e.target.result;
                        localStorage.setItem('userLogo', logoDataUrl);
                        logoImage.src = logoDataUrl;
                    }
                    reader.readAsDataURL(file);
                }
            });

            // --- HEADER SCROLL LOGIC ---
            let lastScrollTop = 0;
            const mainHeader = document.getElementById('main-header');
            window.addEventListener("scroll", function() {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if (scrollTop > lastScrollTop && scrollTop > mainHeader.offsetHeight) {
                    mainHeader.classList.add('header-hidden');
                } else {
                    mainHeader.classList.remove('header-hidden');
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }, false);

            // --- MOBILE MENU LOGIC ---
            function openMobileMenu() {
                mobileMenu.classList.remove('menu-hidden');
                document.body.style.overflow = 'hidden';
            }

            function closeMobileMenu() {
                mobileMenu.classList.add('menu-hidden');
                document.body.style.overflow = '';
            }

            hamburgerBtn.addEventListener('click', openMobileMenu);
            closeMenuBtn.addEventListener('click', closeMobileMenu);
            mobileNavLinks.addEventListener('click', (e) => {
                if (e.target.matches('a.mobile-nav-link')) {
                    const view = e.target.dataset.view;
                    if (view) {
                        switchView(view);
                    }
                    closeMobileMenu();
                }
            });

            // --- INITIALIZATION ---
            function initializeApp() {
                setTimeout(() => {
                    splashScreen.classList.add('fade-out');
                    mainContent.classList.remove('opacity-0');
                    setTimeout(() => {
                        splashScreen.style.display = 'none';
                    }, 1500);
                }, 2000);

                loadLogoFromStorage();
                switchView('home');
                renderLiturgicalCards();
                updateBibleView(); // Initialize the bible view to its root state
            }
            initializeApp();
        });
    </script>
</body>
</html>
